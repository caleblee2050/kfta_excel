# Excel Unifier 알고리즘 설명

## 유사도 계산 방식

Excel Unifier는 **AI API를 사용하지 않고** 전통적인 문자열 유사도 알고리즘을 사용합니다.

### 사용 라이브러리

```python
from fuzzywuzzy import fuzz
```

**FuzzyWuzzy**는 Levenshtein Distance 알고리즘을 기반으로 한 문자열 유사도 측정 라이브러리입니다.

## 1. Levenshtein Distance (편집 거리)

### 원리
두 문자열 간의 **최소 편집 횟수**를 계산합니다.

**편집 연산:**
- 삽입 (Insertion)
- 삭제 (Deletion)
- 치환 (Substitution)

### 예시

```
"이름" → "성명"
- "이" 삭제
- "름" 삭제
- "성" 삽입
- "명" 삽입
편집 거리 = 4
```

```
"학교" → "대학교"
- "대" 삽입 (맨 앞)
편집 거리 = 1
```

## 2. Fuzz.ratio() 함수

### 계산 방식

```python
similarity = fuzz.ratio(col1, col2)  # 0-100 사이의 값
```

**공식:**
```
similarity = (1 - (편집거리 / max(len(str1), len(str2)))) × 100
```

### 실제 예시

#### 예시 1: 컬럼명 매칭
```python
fuzz.ratio("이름", "성명")      # ≈ 0-30 (낮음)
fuzz.ratio("이름", "이 름")     # ≈ 85-90 (높음)
fuzz.ratio("학교", "대학교")    # ≈ 66-75 (중간)
fuzz.ratio("전공", "전공분야")  # ≈ 50-60 (중간)
```

#### 예시 2: 값 매칭
```python
fuzz.ratio("서울대학교", "서울대")     # ≈ 75
fuzz.ratio("서울대학교", "서울大學校") # ≈ 60
fuzz.ratio("연세대", "연세대학교")     # ≈ 75
```

## 3. 유사도 임계값 (Threshold)

### 기본값: 85

```python
if similarity >= self.similarity_threshold:  # 기본 85
    # 같은 것으로 간주
```

### 임계값 의미

| 임계값 | 의미 | 사용 케ース |
|--------|------|------------|
| 90-100 | 매우 엄격 | 거의 동일한 문자열만 매칭 |
| **85-90** | **균형** (기본) | **적절한 유사도 매칭** |
| 75-85 | 관대 | 약간 다른 표현도 매칭 |
| 70-75 | 매우 관대 | 많이 다른 표현도 매칭 |

## 4. 2단계 매칭 시스템

### 1단계: 키워드 기반 매칭 (우선순위 높음)

```python
keyword_mappings = {
    '이름': ['이름', '성명', '학생명', '성함', '이 름'],
    '학교': ['학교', '대학교', '소속대학', '대학', '학 교'],
    '전공': ['전공', '전공분야', '전공과목', '학과'],
    ...
}
```

**장점:**
- 한국어 동의어 처리
- 100% 정확한 매칭
- 성능 우수

**매칭 로직:**
```python
col_normalized = col.strip().replace(' ', '').lower()
if col_normalized == keyword_normalized:
    # 매칭 성공
```

### 2단계: 유사도 기반 매칭

키워드 매칭에서 처리되지 않은 컬럼들은 Levenshtein Distance 기반으로 매칭:

```python
similarity = fuzz.ratio(col1, col2)
if similarity >= 85:  # 임계값
    # 유사한 컬럼으로 간주
```

## 5. 값 정규화 (Normalization)

### 학교명 정규화

```python
def normalize_value(value, value_type='school'):
    replacements = [
        ('大學校', ''),    # 한자 제거
        ('대학교', ''),    # 접미사 제거
        ('대학', ''),
        (' ', ''),        # 공백 제거
    ]
    # 정규화 후 소문자로 변환
    return value.lower()
```

**예시:**
```
"서울대학교" → "서울" → "서울"
"서울大學校" → "서울" → "서울"
"서울 대" → "서울" → "서울"
→ 모두 동일하게 인식!
```

## 6. 전체 프로세스

```
입력: file1.xlsx, file2.xlsx, file3.xlsx

┌─────────────────────────────────────┐
│  1. 파일 로드 및 컬럼 수집           │
│     ["이름", "성명", "학생명"]       │
└─────────────────────────────────────┘
              ↓
┌─────────────────────────────────────┐
│  2. 키워드 기반 매칭 (1단계)         │
│     "성명" → "이름" 그룹             │
│     "학생명" → "이름" 그룹           │
└─────────────────────────────────────┘
              ↓
┌─────────────────────────────────────┐
│  3. 유사도 기반 매칭 (2단계)         │
│     fuzz.ratio("전공", "전공분야")  │
│     = 60 < 85 → 매칭 실패            │
└─────────────────────────────────────┘
              ↓
┌─────────────────────────────────────┐
│  4. 데이터 통합                      │
│     통일된 컬럼명으로 데이터 변환    │
└─────────────────────────────────────┘
              ↓
┌─────────────────────────────────────┐
│  5. 중복 제거 (키 컬럼 기반)         │
│     값 정규화 → 중복 탐지            │
└─────────────────────────────────────┘
              ↓
         출력 파일
```

## 7. 성능 특징

### 장점
✅ **AI API 불필요** - 오프라인 작동
✅ **빠른 처리** - O(n²) 시간 복잡도
✅ **비용 무료** - API 호출 비용 없음
✅ **정확도 높음** - 한국어 키워드 매핑
✅ **투명성** - 알고리즘 명확

### 한계
⚠️ **의미론적 이해 부족** - "이름"과 "성함"을 자동으로 연결 못함 (키워드 사전 필요)
⚠️ **완전히 다른 표현** - "name" vs "이름" 같은 경우 수동 추가 필요

## 8. AI 통합 가능성 (향후 개선)

현재 알고리즘에 AI를 추가하려면:

```python
# 현재 방식
similarity = fuzz.ratio(col1, col2)

# AI 통합 방식 (예시)
if similarity < threshold:
    # AI로 의미론적 유사도 확인
    ai_similarity = openai.embeddings.similarity(col1, col2)
    if ai_similarity > 0.8:
        # AI가 유사하다고 판단
        match = True
```

**장점:**
- "이름"과 "name" 같은 다국어 매칭
- "전화번호"와 "연락처" 같은 의미론적 유사성 인식

**단점:**
- API 비용 발생
- 처리 속도 느림
- 인터넷 연결 필요

## 결론

Excel Unifier는 **Levenshtein Distance 기반의 문자열 유사도 알고리즘**과 **한국어 키워드 사전**을 결합하여:

1. **빠르고**
2. **정확하며**
3. **비용 없이**
4. **오프라인에서도**

엑셀 파일을 통합할 수 있습니다. AI API 없이도 실용적인 결과를 제공합니다! 🚀
