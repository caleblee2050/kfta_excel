#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
KFTA Excel Parser - 강원교총 전용 엑셀 파서
특정 필드 위치 기반으로 데이터 추출 및 변환
"""

import pandas as pd
import re
import json
import os
from typing import Dict, List, Optional
from datetime import datetime


class KFTAParser:
    """강원교총 엑셀 파일 파서"""

    # 강원도 지역명과 교육청 매핑
    GANGWON_REGIONS = {
        '춘천': '강원특별자치도춘천교육지원청',
        '원주': '강원특별자치도원주교육지원청',
        '강릉': '강원특별자치도강릉교육지원청',
        '동해': '강원특별자치도동해교육지원청',
        '태백': '강원특별자치도태백교육지원청',
        '속초': '강원특별자치도속초양양교육지원청',
        '양양': '강원특별자치도속초양양교육지원청',
        '삼척': '강원특별자치도삼척교육지원청',
        '홍천': '강원특별자치도홍천교육지원청',
        '횡성': '강원특별자치도횡성교육지원청',
        '영월': '강원특별자치도영월교육지원청',
        '평창': '강원특별자치도평창교육지원청',
        '정선': '강원특별자치도정선교육지원청',
        '철원': '강원특별자치도철원교육지원청',
        '화천': '강원특별자치도화천교육지원청',
        '양구': '강원특별자치도양구교육지원청',
        '인제': '강원특별자치도인제교육지원청',
        '고성': '강원특별자치도고성교육지원청',
    }

    # 강원도 전체 학교 → 교육청 직접 매핑
    # 교육청 분회 현황 데이터 기반 (2024.11)
    # 총 635개 학교 (초/중/고/유치원)
    GANGWON_ALL_SCHOOLS = {
        # === 강릉 (60개) ===
        '강동초등학교': '강원특별자치도강릉교육지원청',
        '강릉고등학교': '강원특별자치도강릉교육지원청',
        '강릉교동초등학교': '강원특별자치도강릉교육지원청',
        '강릉남산초등학교': '강원특별자치도강릉교육지원청',
        '강릉여자고등학교': '강원특별자치도강릉교육지원청',
        '강릉옥천초등학교': '강원특별자치도강릉교육지원청',
        '강릉정보공업고등학교': '강원특별자치도강릉교육지원청',
        '강릉제일고등학교': '강원특별자치도강릉교육지원청',
        '강릉중앙고등학교': '강원특별자치도강릉교육지원청',
        '강릉중앙초등학교': '강원특별자치도강릉교육지원청',
        '강릉중학교': '강원특별자치도강릉교육지원청',
        '강릉초등학교': '강원특별자치도강릉교육지원청',
        '강릉해람중학교': '강원특별자치도강릉교육지원청',
        '강원예술고등학교': '강원특별자치도강릉교육지원청',
        '경포고등학교': '강원특별자치도강릉교육지원청',
        '경포대초등학교': '강원특별자치도강릉교육지원청',
        '경포유치원': '강원특별자치도강릉교육지원청',
        '경포중학교': '강원특별자치도강릉교육지원청',
        '경포초등학교': '강원특별자치도강릉교육지원청',
        '관동중학교': '강원특별자치도강릉교육지원청',
        '구정초등학교': '강원특별자치도강릉교육지원청',
        '금광초등학교': '강원특별자치도강릉교육지원청',
        '남강초등학교': '강원특별자치도강릉교육지원청',
        '노암초등학교': '강원특별자치도강릉교육지원청',
        '늘해랑유치원': '강원특별자치도강릉교육지원청',
        '동명중학교': '강원특별자치도강릉교육지원청',
        '동명초등학교': '강원특별자치도강릉교육지원청',
        '명주초등학교': '강원특별자치도강릉교육지원청',
        '모산초등학교': '강원특별자치도강릉교육지원청',
        '사천중학교': '강원특별자치도강릉교육지원청',
        '사천초등학교': '강원특별자치도강릉교육지원청',
        '성덕초등학교': '강원특별자치도강릉교육지원청',
        '성산초등학교': '강원특별자치도강릉교육지원청',
        '솔올중학교': '강원특별자치도강릉교육지원청',
        '송양초등학교': '강원특별자치도강릉교육지원청',
        '숲실초등학교': '강원특별자치도강릉교육지원청',
        '신영초등학교': '강원특별자치도강릉교육지원청',
        '신왕초등학교': '강원특별자치도강릉교육지원청',
        '연곡초등학교': '강원특별자치도강릉교육지원청',
        '영동초등학교': '강원특별자치도강릉교육지원청',
        '옥계중학교': '강원특별자치도강릉교육지원청',
        '옥계초등학교': '강원특별자치도강릉교육지원청',
        '옥계초등학교금진분교': '강원특별자치도강릉교육지원청',
        '왕산중학교': '강원특별자치도강릉교육지원청',
        '왕산초등학교': '강원특별자치도강릉교육지원청',
        '운산초등학교': '강원특별자치도강릉교육지원청',
        '운양초등학교': '강원특별자치도강릉교육지원청',
        '유천초등학교': '강원특별자치도강릉교육지원청',
        '율곡중학교': '강원특별자치도강릉교육지원청',
        '율곡초등학교': '강원특별자치도강릉교육지원청',
        '정동초등학교': '강원특별자치도강릉교육지원청',
        '주문진고등학교': '강원특별자치도강릉교육지원청',
        '주문진중학교': '강원특별자치도강릉교육지원청',
        '주문진초등학교': '강원특별자치도강릉교육지원청',
        '주영초등학교': '강원특별자치도강릉교육지원청',
        '초당초등학교': '강원특별자치도강릉교육지원청',
        '포남초등학교': '강원특별자치도강릉교육지원청',
        '하슬라유치원': '강원특별자치도강릉교육지원청',
        '하슬라중학교': '강원특별자치도강릉교육지원청',
        '한솔초등학교': '강원특별자치도강릉교육지원청',

        # === 고성 (21개) ===
        '간성초등학교': '강원특별자치도고성교육지원청',
        '거성초등학교': '강원특별자치도고성교육지원청',
        '거진고등학교': '강원특별자치도고성교육지원청',
        '거진중학교': '강원특별자치도고성교육지원청',
        '거진초등학교': '강원특별자치도고성교육지원청',
        '고성고등학교': '강원특별자치도고성교육지원청',
        '고성중학교': '강원특별자치도고성교육지원청',
        '공현진초등학교': '강원특별자치도고성교육지원청',
        '광산초등학교': '강원특별자치도고성교육지원청',
        '대진고등학교': '강원특별자치도고성교육지원청',
        '대진중학교': '강원특별자치도고성교육지원청',
        '대진초등학교': '강원특별자치도고성교육지원청',
        '도학초등학교': '강원특별자치도고성교육지원청',
        '동광산업과학고등학교': '강원특별자치도고성교육지원청',
        '동광중학교': '강원특별자치도고성교육지원청',
        '동광초등학교': '강원특별자치도고성교육지원청',
        '아야진초등학교': '강원특별자치도고성교육지원청',
        '오호초등학교': '강원특별자치도고성교육지원청',
        '인흥초등학교': '강원특별자치도고성교육지원청',
        '죽왕초등학교': '강원특별자치도고성교육지원청',
        '천진초등학교': '강원특별자치도고성교육지원청',

        # === 동해 (25개) ===
        '남호초등학교': '강원특별자치도동해교육지원청',
        '동해랑유치원': '강원특별자치도동해교육지원청',
        '동해상업고등학교': '강원특별자치도동해교육지원청',
        '동해중앙초등학교': '강원특별자치도동해교육지원청',
        '동해중학교': '강원특별자치도동해교육지원청',
        '동해초등학교': '강원특별자치도동해교육지원청',
        '동해해솔학교': '강원특별자치도동해교육지원청',
        '동호초등학교': '강원특별자치도동해교육지원청',
        '망상초등학교': '강원특별자치도동해교육지원청',
        '묵호고등학교': '강원특별자치도동해교육지원청',
        '묵호중학교': '강원특별자치도동해교육지원청',
        '묵호초등학교': '강원특별자치도동해교육지원청',
        '북삼초등학교': '강원특별자치도동해교육지원청',
        '북평고등학교': '강원특별자치도동해교육지원청',
        '북평여자고등학교': '강원특별자치도동해교육지원청',
        '북평중학교': '강원특별자치도동해교육지원청',
        '북평초등학교': '강원특별자치도동해교육지원청',
        '삼화초등학교': '강원특별자치도동해교육지원청',
        '송정초등학교': '강원특별자치도동해교육지원청',
        '예람중학교': '강원특별자치도동해교육지원청',
        '창호초등학교': '강원특별자치도동해교육지원청',
        '천곡초등학교': '강원특별자치도동해교육지원청',
        '청운초등학교': '강원특별자치도동해교육지원청',
        '하랑중학교': '강원특별자치도동해교육지원청',
        '해오름유치원': '강원특별자치도동해교육지원청',

        # === 삼척 (38개) ===
        '가곡고등학교': '강원특별자치도삼척교육지원청',
        '가곡중학교': '강원특별자치도삼척교육지원청',
        '근덕중학교': '강원특별자치도삼척교육지원청',
        '근덕초등학교': '강원특별자치도삼척교육지원청',
        '도계고등학교': '강원특별자치도삼척교육지원청',
        '도계전산정보고등학교': '강원특별자치도삼척교육지원청',
        '도계중학교': '강원특별자치도삼척교육지원청',
        '도계초등학교': '강원특별자치도삼척교육지원청',
        '도계한빛유치원': '강원특별자치도삼척교육지원청',
        '맹방초등학교': '강원특별자치도삼척교육지원청',
        '미로중학교': '강원특별자치도삼척교육지원청',
        '미로초등학교': '강원특별자치도삼척교육지원청',
        '삼척고등학교': '강원특별자치도삼척교육지원청',
        '삼척남초등학교': '강원특별자치도삼척교육지원청',
        '삼척누리유치원': '강원특별자치도삼척교육지원청',
        '삼척신동초등학교': '강원특별자치도삼척교육지원청',
        '삼척여자고등학교': '강원특별자치도삼척교육지원청',
        '삼척중앙초등학교': '강원특별자치도삼척교육지원청',
        '삼척중학교': '강원특별자치도삼척교육지원청',
        '삼척초등학교': '강원특별자치도삼척교육지원청',
        '서부초등학교': '강원특별자치도삼척교육지원청',
        '오저초등학교': '강원특별자치도삼척교육지원청',
        '원덕고등학교': '강원특별자치도삼척교육지원청',
        '원덕중학교': '강원특별자치도삼척교육지원청',
        '임원중학교': '강원특별자치도삼척교육지원청',
        '임원초등학교': '강원특별자치도삼척교육지원청',
        '장원초등학교': '강원특별자치도삼척교육지원청',
        '장호중학교': '강원특별자치도삼척교육지원청',
        '장호초등학교': '강원특별자치도삼척교육지원청',
        '정라초등학교': '강원특별자치도삼척교육지원청',
        '진주초등학교': '강원특별자치도삼척교육지원청',
        '청아중학교': '강원특별자치도삼척교육지원청',
        '하장고등학교': '강원특별자치도삼척교육지원청',
        '하장중학교': '강원특별자치도삼척교육지원청',
        '하장초등학교': '강원특별자치도삼척교육지원청',
        '한국에너지마이스터고등학교': '강원특별자치도삼척교육지원청',
        '호산초등학교': '강원특별자치도삼척교육지원청',
        '흥전초등학교': '강원특별자치도삼척교육지원청',

        # === 속초양양 (21개) ===
        '대포초등학교': '강원특별자치도속초양양교육지원청',
        '산호유치원': '강원특별자치도속초양양교육지원청',
        '설악고등학교': '강원특별자치도속초양양교육지원청',
        '설악중학교': '강원특별자치도속초양양교육지원청',
        '설악초등학교': '강원특별자치도속초양양교육지원청',
        '설온중학교': '강원특별자치도속초양양교육지원청',
        '소야초등학교': '강원특별자치도속초양양교육지원청',
        '속초고등학교': '강원특별자치도속초양양교육지원청',
        '속초교동초등학교': '강원특별자치도속초양양교육지원청',
        '속초여자고등학교': '강원특별자치도속초양양교육지원청',
        '속초유치원': '강원특별자치도속초양양교육지원청',
        '속초조양초등학교': '강원특별자치도속초양양교육지원청',
        '속초중앙초등학교': '강원특별자치도속초양양교육지원청',
        '속초중학교': '강원특별자치도속초양양교육지원청',
        '속초초등학교': '강원특별자치도속초양양교육지원청',
        '속초해랑중학교': '강원특별자치도속초양양교육지원청',
        '영랑초등학교': '강원특별자치도속초양양교육지원청',
        '온정초등학교': '강원특별자치도속초양양교육지원청',
        '청대초등학교': '강원특별자치도속초양양교육지원청',
        '청봉초등학교': '강원특별자치도속초양양교육지원청',
        '청호초등학교': '강원특별자치도속초양양교육지원청',

        # === 양구 (18개) ===
        '대암중학교': '강원특별자치도양구교육지원청',
        '도촌초등학교': '강원특별자치도양구교육지원청',
        '방산중학교': '강원특별자치도양구교육지원청',
        '방산초등학교': '강원특별자치도양구교육지원청',
        '비봉초등학교': '강원특별자치도양구교육지원청',
        '석천중학교': '강원특별자치도양구교육지원청',
        '양구고등학교': '강원특별자치도양구교육지원청',
        '양구여자고등학교': '강원특별자치도양구교육지원청',
        '양구원당초등학교': '강원특별자치도양구교육지원청',
        '양구중학교': '강원특별자치도양구교육지원청',
        '양구초등학교': '강원특별자치도양구교육지원청',
        '용하중학교': '강원특별자치도양구교육지원청',
        '용하초등학교': '강원특별자치도양구교육지원청',
        '임당초등학교': '강원특별자치도양구교육지원청',
        '죽리초등학교': '강원특별자치도양구교육지원청',
        '한전초등학교': '강원특별자치도양구교육지원청',
        '해안중학교': '강원특별자치도양구교육지원청',
        '해안초등학교': '강원특별자치도양구교육지원청',

        # === 양양 (21개) ===
        '강현중학교': '강원특별자치도양양교육지원청',
        '강현초등학교': '강원특별자치도양양교육지원청',
        '광정초등학교': '강원특별자치도양양교육지원청',
        '남애초등학교': '강원특별자치도양양교육지원청',
        '상평초등학교': '강원특별자치도양양교육지원청',
        '상평초등학교공수전분교': '강원특별자치도양양교육지원청',
        '상평초등학교오색분교': '강원특별자치도양양교육지원청',
        '상평초등학교현서분교': '강원특별자치도양양교육지원청',
        '손양초등학교': '강원특별자치도양양교육지원청',
        '송포초등학교': '강원특별자치도양양교육지원청',
        '양양고등학교': '강원특별자치도양양교육지원청',
        '양양중학교': '강원특별자치도양양교육지원청',
        '양양초등학교': '강원특별자치도양양교육지원청',
        '인구초등학교': '강원특별자치도양양교육지원청',
        '조산초등학교': '강원특별자치도양양교육지원청',
        '한남초등학교': '강원특별자치도양양교육지원청',
        '현남중학교': '강원특별자치도양양교육지원청',
        '현북중학교': '강원특별자치도양양교육지원청',
        '현북초등학교': '강원특별자치도양양교육지원청',
        '현성초등학교': '강원특별자치도양양교육지원청',
        '회룡초등학교': '강원특별자치도양양교육지원청',

        # === 영월 (27개) ===
        '구래초등학교': '강원특별자치도영월교육지원청',
        '내성초등학교': '강원특별자치도영월교육지원청',
        '녹전중학교': '강원특별자치도영월교육지원청',
        '녹전초등학교': '강원특별자치도영월교육지원청',
        '마차고등학교': '강원특별자치도영월교육지원청',
        '마차중학교': '강원특별자치도영월교육지원청',
        '마차초등학교': '강원특별자치도영월교육지원청',
        '무릉초등학교': '강원특별자치도영월교육지원청',
        '봉래중학교': '강원특별자치도영월교육지원청',
        '봉래초등학교': '강원특별자치도영월교육지원청',
        '상동고등학교': '강원특별자치도영월교육지원청',
        '상동중학교': '강원특별자치도영월교육지원청',
        '신천초등학교': '강원특별자치도영월교육지원청',
        '쌍룡중학교': '강원특별자치도영월교육지원청',
        '쌍룡초등학교': '강원특별자치도영월교육지원청',
        '연당중학교': '강원특별자치도영월교육지원청',
        '연당초등학교': '강원특별자치도영월교육지원청',
        '영월고등학교': '강원특별자치도영월교육지원청',
        '영월중학교': '강원특별자치도영월교육지원청',
        '영월초등학교': '강원특별자치도영월교육지원청',
        '옥동중학교': '강원특별자치도영월교육지원청',
        '옥동초등학교': '강원특별자치도영월교육지원청',
        '주천고등학교': '강원특별자치도영월교육지원청',
        '주천중학교': '강원특별자치도영월교육지원청',
        '주천초등학교': '강원특별자치도영월교육지원청',
        '청령포초등학교': '강원특별자치도영월교육지원청',
        '한국소방마이스터고등학교': '강원특별자치도영월교육지원청',

        # === 원주 (84개) ===
        '강원과학고등학교': '강원특별자치도원주교육지원청',
        '강원온라인학교': '강원특별자치도원주교육지원청',
        '고산초등학교': '강원특별자치도원주교육지원청',
        '관설초등학교': '강원특별자치도원주교육지원청',
        '교학초등학교': '강원특별자치도원주교육지원청',
        '구곡초등학교': '강원특별자치도원주교육지원청',
        '귀래초등학교': '강원특별자치도원주교육지원청',
        '금대초등학교': '강원특별자치도원주교육지원청',
        '남원주중학교': '강원특별자치도원주교육지원청',
        '남원주초등학교': '강원특별자치도원주교육지원청',
        '단계초등학교': '강원특별자치도원주교육지원청',
        '단관초등학교': '강원특별자치도원주교육지원청',
        '단구중학교': '강원특별자치도원주교육지원청',
        '단구초등학교': '강원특별자치도원주교육지원청',
        '동화초등학교': '강원특별자치도원주교육지원청',
        '둔둔초등학교': '강원특별자치도원주교육지원청',
        '만대초등학교': '강원특별자치도원주교육지원청',
        '만종초등학교': '강원특별자치도원주교육지원청',
        '매지초등학교': '강원특별자치도원주교육지원청',
        '명륜초등학교': '강원특별자치도원주교육지원청',
        '무실빛유치원': '강원특별자치도원주교육지원청',
        '무실초등학교': '강원특별자치도원주교육지원청',
        '문막고등학교': '강원특별자치도원주교육지원청',
        '문막중학교': '강원특별자치도원주교육지원청',
        '문막초등학교': '강원특별자치도원주교육지원청',
        '미래고등학교': '강원특별자치도원주교육지원청',
        '반계초등학교': '강원특별자치도원주교육지원청',
        '반곡별유치원': '강원특별자치도원주교육지원청',
        '반곡중학교': '강원특별자치도원주교육지원청',
        '버들중학교': '강원특별자치도원주교육지원청',
        '버들초등학교': '강원특별자치도원주교육지원청',
        '봉대초등학교': '강원특별자치도원주교육지원청',
        '부론중학교': '강원특별자치도원주교육지원청',
        '부론초등학교': '강원특별자치도원주교육지원청',
        '북원여자고등학교': '강원특별자치도원주교육지원청',
        '북원중학교': '강원특별자치도원주교육지원청',
        '북원초등학교': '강원특별자치도원주교육지원청',
        '비두초등학교': '강원특별자치도원주교육지원청',
        '산현초등학교': '강원특별자치도원주교육지원청',
        '샘마루초등학교': '강원특별자치도원주교육지원청',
        '서곡초등학교': '강원특별자치도원주교육지원청',
        '서원주초등학교': '강원특별자치도원주교육지원청',
        '섬강고등학교': '강원특별자치도원주교육지원청',
        '섬강중학교': '강원특별자치도원주교육지원청',
        '섬강초등학교': '강원특별자치도원주교육지원청',
        '소초초등학교': '강원특별자치도원주교육지원청',
        '솔샘초등학교': '강원특별자치도원주교육지원청',
        '신림중학교': '강원특별자치도원주교육지원청',
        '신림초등학교': '강원특별자치도원주교육지원청',
        '신평초등학교': '강원특별자치도원주교육지원청',
        '영서고등학교': '강원특별자치도원주교육지원청',
        '우산초등학교': '강원특별자치도원주교육지원청',
        '원주고등학교': '강원특별자치도원주교육지원청',
        '원주교동초등학교': '강원특별자치도원주교육지원청',
        '원주금융회계고등학교': '강원특별자치도원주교육지원청',
        '원주반곡초등학교': '강원특별자치도원주교육지원청',
        '원주여자고등학교': '강원특별자치도원주교육지원청',
        '원주여자중학교': '강원특별자치도원주교육지원청',
        '원주의료고등학교': '강원특별자치도원주교육지원청',
        '원주중앙초등학교': '강원특별자치도원주교육지원청',
        '원주중학교': '강원특별자치도원주교육지원청',
        '원주초등학교': '강원특별자치도원주교육지원청',
        '일산초등학교': '강원특별자치도원주교육지원청',
        '장양초등학교': '강원특별자치도원주교육지원청',
        '지정샘유치원': '강원특별자치도원주교육지원청',
        '지정중학교': '강원특별자치도원주교육지원청',
        '지정초등학교': '강원특별자치도원주교육지원청',
        '치악고등학교': '강원특별자치도원주교육지원청',
        '치악중학교': '강원특별자치도원주교육지원청',
        '치악초등학교': '강원특별자치도원주교육지원청',
        '태봉초등학교': '강원특별자치도원주교육지원청',
        '태장중학교': '강원특별자치도원주교육지원청',
        '태장초등학교': '강원특별자치도원주교육지원청',
        '평원중학교': '강원특별자치도원주교육지원청',
        '평원초등학교': '강원특별자치도원주교육지원청',
        '학성유치원': '강원특별자치도원주교육지원청',
        '학성중학교': '강원특별자치도원주교육지원청',
        '학성초등학교': '강원특별자치도원주교육지원청',
        '호저중학교': '강원특별자치도원주교육지원청',
        '호저초등학교': '강원특별자치도원주교육지원청',
        '황둔중학교': '강원특별자치도원주교육지원청',
        '황둔초등학교': '강원특별자치도원주교육지원청',
        '흥양초등학교': '강원특별자치도원주교육지원청',
        '흥업초등학교': '강원특별자치도원주교육지원청',

        # === 인제 (25개) ===
        '귀둔초등학교': '강원특별자치도인제교육지원청',
        '기린고등학교': '강원특별자치도인제교육지원청',
        '기린중학교': '강원특별자치도인제교육지원청',
        '기린초등학교': '강원특별자치도인제교육지원청',
        '기린초등학교진동분교': '강원특별자치도인제교육지원청',
        '부평초등학교': '강원특별자치도인제교육지원청',
        '상남중학교': '강원특별자치도인제교육지원청',
        '상남초등학교': '강원특별자치도인제교육지원청',
        '서화중학교': '강원특별자치도인제교육지원청',
        '서화초등학교': '강원특별자치도인제교육지원청',
        '신남고등학교': '강원특별자치도인제교육지원청',
        '신남중학교': '강원특별자치도인제교육지원청',
        '어론초등학교': '강원특별자치도인제교육지원청',
        '용대초등학교': '강원특별자치도인제교육지원청',
        '원통고등학교': '강원특별자치도인제교육지원청',
        '원통중학교': '강원특별자치도인제교육지원청',
        '원통초등학교': '강원특별자치도인제교육지원청',
        '월학초등학교': '강원특별자치도인제교육지원청',
        '인제고등학교': '강원특별자치도인제교육지원청',
        '인제남초등학교': '강원특별자치도인제교육지원청',
        '인제중학교': '강원특별자치도인제교육지원청',
        '인제초등학교': '강원특별자치도인제교육지원청',
        '하남초등학교': '강원특별자치도인제교육지원청',
        '하늘내린유치원': '강원특별자치도인제교육지원청',
        '한계초등학교': '강원특별자치도인제교육지원청',

        # === 정선 (35개) ===
        '갈래초등학교': '강원특별자치도정선교육지원청',
        '고한고등학교': '강원특별자치도정선교육지원청',
        '고한중학교': '강원특별자치도정선교육지원청',
        '고한초등학교': '강원특별자치도정선교육지원청',
        '나전중학교': '강원특별자치도정선교육지원청',
        '남선초등학교': '강원특별자치도정선교육지원청',
        '남선초등학교남창분교': '강원특별자치도정선교육지원청',
        '남평초등학교': '강원특별자치도정선교육지원청',
        '백전초등학교': '강원특별자치도정선교육지원청',
        '벽탄초등학교': '강원특별자치도정선교육지원청',
        '봉양초등학교': '강원특별자치도정선교육지원청',
        '사북고등학교': '강원특별자치도정선교육지원청',
        '사북중학교': '강원특별자치도정선교육지원청',
        '사북초등학교': '강원특별자치도정선교육지원청',
        '여량고등학교': '강원특별자치도정선교육지원청',
        '여량중학교': '강원특별자치도정선교육지원청',
        '여량초등학교': '강원특별자치도정선교육지원청',
        '예미초등학교': '강원특별자치도정선교육지원청',
        '예미초등학교운치분교': '강원특별자치도정선교육지원청',
        '임계고등학교': '강원특별자치도정선교육지원청',
        '임계중학교': '강원특별자치도정선교육지원청',
        '임계초등학교': '강원특별자치도정선교육지원청',
        '정선고등학교': '강원특별자치도정선교육지원청',
        '정선북평초등학교': '강원특별자치도정선교육지원청',
        '정선유치원': '강원특별자치도정선교육지원청',
        '정선정보공업고등학교': '강원특별자치도정선교육지원청',
        '정선중학교': '강원특별자치도정선교육지원청',
        '정선초등학교': '강원특별자치도정선교육지원청',
        '정선초등학교가수분교': '강원특별자치도정선교육지원청',
        '증산초등학교': '강원특별자치도정선교육지원청',
        '함백고등학교': '강원특별자치도정선교육지원청',
        '함백중학교': '강원특별자치도정선교육지원청',
        '함백초등학교': '강원특별자치도정선교육지원청',
        '화동중학교': '강원특별자치도정선교육지원청',
        '화동초등학교': '강원특별자치도정선교육지원청',

        # === 철원 (27개) ===
        '근남초등학교': '강원특별자치도철원교육지원청',
        '김화고등학교': '강원특별자치도철원교육지원청',
        '김화공업고등학교': '강원특별자치도철원교육지원청',
        '김화여자중학교': '강원특별자치도철원교육지원청',
        '김화중학교': '강원특별자치도철원교육지원청',
        '김화초등학교': '강원특별자치도철원교육지원청',
        '내대초등학교': '강원특별자치도철원교육지원청',
        '도창초등학교': '강원특별자치도철원교육지원청',
        '동송초등학교': '강원특별자치도철원교육지원청',
        '묘장초등학교': '강원특별자치도철원교육지원청',
        '문혜초등학교': '강원특별자치도철원교육지원청',
        '새들유치원': '강원특별자치도철원교육지원청',
        '서면초등학교': '강원특별자치도철원교육지원청',
        '신철원고등학교': '강원특별자치도철원교육지원청',
        '신철원중학교': '강원특별자치도철원교육지원청',
        '신철원초등학교': '강원특별자치도철원교육지원청',
        '오덕초등학교': '강원특별자치도철원교육지원청',
        '와수초등학교': '강원특별자치도철원교육지원청',
        '용정초등학교': '강원특별자치도철원교육지원청',
        '장흥초등학교': '강원특별자치도철원교육지원청',
        '철원고등학교': '강원특별자치도철원교육지원청',
        '철원여자고등학교': '강원특별자치도철원교육지원청',
        '철원여자중학교': '강원특별자치도철원교육지원청',
        '철원중학교': '강원특별자치도철원교육지원청',
        '철원초등학교': '강원특별자치도철원교육지원청',
        '청양초등학교': '강원특별자치도철원교육지원청',
        '토성초등학교': '강원특별자치도철원교육지원청',

        # === 춘천 (72개) ===
        '가산초등학교': '강원특별자치도춘천교육지원청',
        '가정중학교': '강원특별자치도춘천교육지원청',
        '강서중학교': '강원특별자치도춘천교육지원청',
        '강원사대부설고등학교': '강원특별자치도춘천교육지원청',
        '강원생명과학고등학교': '강원특별자치도춘천교육지원청',
        '강원애니고등학교': '강원특별자치도춘천교육지원청',
        '강원체육고등학교': '강원특별자치도춘천교육지원청',
        '강원체육중학교': '강원특별자치도춘천교육지원청',
        '광판중학교': '강원특별자치도춘천교육지원청',
        '광판초등학교': '강원특별자치도춘천교육지원청',
        '근화초등학교': '강원특별자치도춘천교육지원청',
        '금병초등학교': '강원특별자치도춘천교육지원청',
        '금산초등학교': '강원특별자치도춘천교육지원청',
        '남부초등학교': '강원특별자치도춘천교육지원청',
        '남춘천여자중학교': '강원특별자치도춘천교육지원청',
        '남춘천중학교': '강원특별자치도춘천교육지원청',
        '남춘천초등학교': '강원특별자치도춘천교육지원청',
        '당림초등학교': '강원특별자치도춘천교육지원청',
        '대룡중학교': '강원특별자치도춘천교육지원청',
        '동내초등학교': '강원특별자치도춘천교육지원청',
        '동부초등학교': '강원특별자치도춘천교육지원청',
        '동산중학교': '강원특별자치도춘천교육지원청',
        '동춘천초등학교': '강원특별자치도춘천교육지원청',
        '만천유치원': '강원특별자치도춘천교육지원청',
        '만천초등학교': '강원특별자치도춘천교육지원청',
        '봄내중학교': '강원특별자치도춘천교육지원청',
        '봄내초등학교': '강원특별자치도춘천교육지원청',
        '봄봄유치원': '강원특별자치도춘천교육지원청',
        '봉의고등학교': '강원특별자치도춘천교육지원청',
        '봉의중학교': '강원특별자치도춘천교육지원청',
        '봉의초등학교': '강원특별자치도춘천교육지원청',
        '부안초등학교': '강원특별자치도춘천교육지원청',
        '상천초등학교': '강원특별자치도춘천교육지원청',
        '새봄유치원': '강원특별자치도춘천교육지원청',
        '서상초등학교': '강원특별자치도춘천교육지원청',
        '석사초등학교': '강원특별자치도춘천교육지원청',
        '성림초등학교': '강원특별자치도춘천교육지원청',
        '성원초등학교': '강원특별자치도춘천교육지원청',
        '소양중학교': '강원특별자치도춘천교육지원청',
        '소양초등학교': '강원특별자치도춘천교육지원청',
        '송화초등학교': '강원특별자치도춘천교육지원청',
        '신남초등학교': '강원특별자치도춘천교육지원청',
        '신포중학교': '강원특별자치도춘천교육지원청',
        '오동초등학교': '강원특별자치도춘천교육지원청',
        '우석중학교': '강원특별자치도춘천교육지원청',
        '우석초등학교': '강원특별자치도춘천교육지원청',
        '장학초등학교': '강원특별자치도춘천교육지원청',
        '지촌초등학교': '강원특별자치도춘천교육지원청',
        '지촌초등학교지암분교': '강원특별자치도춘천교육지원청',
        '창촌중학교': '강원특별자치도춘천교육지원청',
        '천전초등학교': '강원특별자치도춘천교육지원청',
        '추곡초등학교': '강원특별자치도춘천교육지원청',
        '춘성중학교': '강원특별자치도춘천교육지원청',
        '춘천고등학교': '강원특별자치도춘천교육지원청',
        '춘천교대부설초등학교': '강원특별자치도춘천교육지원청',
        '춘천교동초등학교': '강원특별자치도춘천교육지원청',
        '춘천기계공업고등학교': '강원특별자치도춘천교육지원청',
        '춘천남산초등학교': '강원특별자치도춘천교육지원청',
        '춘천남산초등학교서천분교': '강원특별자치도춘천교육지원청',
        '춘천신동초등학교': '강원특별자치도춘천교육지원청',
        '춘천여자고등학교': '강원특별자치도춘천교육지원청',
        '춘천조양초등학교': '강원특별자치도춘천교육지원청',
        '춘천중앙초등학교': '강원특별자치도춘천교육지원청',
        '춘천중학교': '강원특별자치도춘천교육지원청',
        '춘천초등학교': '강원특별자치도춘천교육지원청',
        '춘천한샘고등학교': '강원특별자치도춘천교육지원청',
        '퇴계중학교': '강원특별자치도춘천교육지원청',
        '퇴계초등학교': '강원특별자치도춘천교육지원청',
        '호반초등학교': '강원특별자치도춘천교육지원청',
        '효제초등학교': '강원특별자치도춘천교육지원청',
        '후평중학교': '강원특별자치도춘천교육지원청',
        '후평중학교': '강원특별자치도춘천교육지원청',
        '후평초등학교': '강원특별자치도춘천교육지원청',
        '온의유치원': '강원특별자치도춘천교육지원청',
        '춘천동원학교': '강원특별자치도춘천교육지원청',
        '춘천계성학교': '강원특별자치도춘천교육지원청',

        # === 태백 (26개) ===
        '동점초등학교': '강원특별자치도태백교육지원청',
        '미동초등학교': '강원특별자치도태백교육지원청',
        '삼성초등학교': '강원특별자치도태백교육지원청',
        '상장중학교': '강원특별자치도태백교육지원청',
        '상장초등학교': '강원특별자치도태백교육지원청',
        '세연중학교': '강원특별자치도태백교육지원청',
        '장성여자고등학교': '강원특별자치도태백교육지원청',
        '장성여자중학교': '강원특별자치도태백교육지원청',
        '장성초등학교': '강원특별자치도태백교육지원청',
        '철암고등학교': '강원특별자치도태백교육지원청',
        '철암중학교': '강원특별자치도태백교육지원청',
        '철암초등학교': '강원특별자치도태백교육지원청',
        '태백중학교': '강원특별자치도태백교육지원청',
        '태백초등학교': '강원특별자치도태백교육지원청',
        '태사랑유치원': '강원특별자치도태백교육지원청',
        '태서초등학교': '강원특별자치도태백교육지원청',
        '통리초등학교': '강원특별자치도태백교육지원청',
        '하늘빛유치원': '강원특별자치도태백교육지원청',
        '한국항공고등학교': '강원특별자치도태백교육지원청',
        '함태중학교': '강원특별자치도태백교육지원청',
        '함태초등학교': '강원특별자치도태백교육지원청',
        '황지고등학교': '강원특별자치도태백교육지원청',
        '황지정보산업고등학교': '강원특별자치도태백교육지원청',
        '황지중앙초등학교': '강원특별자치도태백교육지원청',
        '황지중학교': '강원특별자치도태백교육지원청',
        '황지초등학교': '강원특별자치도태백교육지원청',

        # === 평창 (32개) ===
        '가평초등학교': '강원특별자치도평창교육지원청',
        '거문초등학교': '강원특별자치도평창교육지원청',
        '계촌중학교': '강원특별자치도평창교육지원청',
        '계촌초등학교': '강원특별자치도평창교육지원청',
        '대관령중학교': '강원특별자치도평창교육지원청',
        '대관령초등학교': '강원특별자치도평창교육지원청',
        '대화고등학교': '강원특별자치도평창교육지원청',
        '대화중학교': '강원특별자치도평창교육지원청',
        '대화초등학교': '강원특별자치도평창교육지원청',
        '도성초등학교': '강원특별자치도평창교육지원청',
        '메밀꽃유치원': '강원특별자치도평창교육지원청',
        '면온초등학교': '강원특별자치도평창교육지원청',
        '미탄중학교': '강원특별자치도평창교육지원청',
        '미탄초등학교': '강원특별자치도평창교육지원청',
        '방림초등학교': '강원특별자치도평창교육지원청',
        '봉평고등학교': '강원특별자치도평창교육지원청',
        '봉평중학교': '강원특별자치도평창교육지원청',
        '봉평초등학교': '강원특별자치도평창교육지원청',
        '속사초등학교': '강원특별자치도평창교육지원청',
        '신리초등학교': '강원특별자치도평창교육지원청',
        '안미초등학교': '강원특별자치도평창교육지원청',
        '용전중학교': '강원특별자치도평창교육지원청',
        '장평초등학교': '강원특별자치도평창교육지원청',
        '주진초등학교': '강원특별자치도평창교육지원청',
        '진부고등학교': '강원특별자치도평창교육지원청',
        '진부중학교': '강원특별자치도평창교육지원청',
        '진부초등학교': '강원특별자치도평창교육지원청',
        '평창고등학교': '강원특별자치도평창교육지원청',
        '평창중학교': '강원특별자치도평창교육지원청',
        '평창초등학교': '강원특별자치도평창교육지원청',
        '호명초등학교': '강원특별자치도평창교육지원청',
        '횡계초등학교': '강원특별자치도평창교육지원청',

        # === 홍천 (44개) ===
        '강원생활과학고등학교': '강원특별자치도홍천교육지원청',
        '구송초등학교': '강원특별자치도홍천교육지원청',
        '내면고등학교': '강원특별자치도홍천교육지원청',
        '내면중학교': '강원특별자치도홍천교육지원청',
        '내촌중학교': '강원특별자치도홍천교육지원청',
        '내촌초등학교': '강원특별자치도홍천교육지원청',
        '너브내유치원': '강원특별자치도홍천교육지원청',
        '노천초등학교': '강원특별자치도홍천교육지원청',
        '대곡초등학교': '강원특별자치도홍천교육지원청',
        '동화중학교': '강원특별자치도홍천교육지원청',
        '두촌중학교': '강원특별자치도홍천교육지원청',
        '두촌초등학교': '강원특별자치도홍천교육지원청',
        '매산초등학교': '강원특별자치도홍천교육지원청',
        '명덕초등학교': '강원특별자치도홍천교육지원청',
        '모곡초등학교': '강원특별자치도홍천교육지원청',
        '삼생초등학교': '강원특별자치도홍천교육지원청',
        '삼포초등학교': '강원특별자치도홍천교육지원청',
        '서석고등학교': '강원특별자치도홍천교육지원청',
        '서석중학교': '강원특별자치도홍천교육지원청',
        '서석초등학교': '강원특별자치도홍천교육지원청',
        '서석초등학교청량분교': '강원특별자치도홍천교육지원청',
        '석화초등학교': '강원특별자치도홍천교육지원청',
        '양덕중학교': '강원특별자치도홍천교육지원청',
        '오안초등학교': '강원특별자치도홍천교육지원청',
        '율전초등학교': '강원특별자치도홍천교육지원청',
        '주봉초등학교': '강원특별자치도홍천교육지원청',
        '창촌초등학교': '강원특별자치도홍천교육지원청',
        '한서중학교': '강원특별자치도홍천교육지원청',
        '한서초등학교': '강원특별자치도홍천교육지원청',
        '협신초등학교': '강원특별자치도홍천교육지원청',
        '홍천고등학교': '강원특별자치도홍천교육지원청',
        '홍천남산유치원': '강원특별자치도홍천교육지원청',
        '홍천남산초등학교': '강원특별자치도홍천교육지원청',
        '홍천농업고등학교': '강원특별자치도홍천교육지원청',
        '홍천반곡초등학교': '강원특별자치도홍천교육지원청',
        '홍천속초초등학교': '강원특별자치도홍천교육지원청',
        '홍천여자고등학교': '강원특별자치도홍천교육지원청',
        '홍천여자중학교': '강원특별자치도홍천교육지원청',
        '홍천원당초등학교': '강원특별자치도홍천교육지원청',
        '홍천중학교': '강원특별자치도홍천교육지원청',
        '홍천초등학교': '강원특별자치도홍천교육지원청',
        '화계초등학교': '강원특별자치도홍천교육지원청',
        '화촌중학교': '강원특별자치도홍천교육지원청',
        '화촌초등학교': '강원특별자치도홍천교육지원청',

        # === 화천 (27개) ===
        '간동고등학교': '강원특별자치도화천교육지원청',
        '간동중학교': '강원특별자치도화천교육지원청',
        '광덕유치원': '강원특별자치도화천교육지원청',
        '광덕초등학교': '강원특별자치도화천교육지원청',
        '다목유치원': '강원특별자치도화천교육지원청',
        '다목초등학교': '강원특별자치도화천교육지원청',
        '봉오유치원': '강원특별자치도화천교육지원청',
        '봉오초등학교': '강원특별자치도화천교육지원청',
        '사내고등학교': '강원특별자치도화천교육지원청',
        '사내유치원': '강원특별자치도화천교육지원청',
        '사내중학교': '강원특별자치도화천교육지원청',
        '사내초등학교': '강원특별자치도화천교육지원청',
        '산양초등학교': '강원특별자치도화천교육지원청',
        '상서중학교': '강원특별자치도화천교육지원청',
        '상승초등학교': '강원특별자치도화천교육지원청',
        '실내유치원': '강원특별자치도화천교육지원청',
        '실내초등학교': '강원특별자치도화천교육지원청',
        '용암초등학교': '강원특별자치도화천교육지원청',
        '원천초등학교': '강원특별자치도화천교육지원청',
        '유촌초등학교': '강원특별자치도화천교육지원청',
        '유촌초등학교오음분교': '강원특별자치도화천교육지원청',
        '풍산초등학교': '강원특별자치도화천교육지원청',
        '화천고등학교': '강원특별자치도화천교육지원청',
        '화천유치원': '강원특별자치도화천교육지원청',
        '화천정보산업고등학교': '강원특별자치도화천교육지원청',
        '화천중학교': '강원특별자치도화천교육지원청',
        '화천초등학교': '강원특별자치도화천교육지원청',

        # === 횡성 (32개) ===
        '갑천고등학교': '강원특별자치도횡성교육지원청',
        '갑천중학교': '강원특별자치도횡성교육지원청',
        '갑천초등학교': '강원특별자치도횡성교육지원청',
        '강림중학교': '강원특별자치도횡성교육지원청',
        '강림초등학교': '강원특별자치도횡성교육지원청',
        '공근중학교': '강원특별자치도횡성교육지원청',
        '공근초등학교': '강원특별자치도횡성교육지원청',
        '둔내고등학교': '강원특별자치도횡성교육지원청',
        '둔내중학교': '강원특별자치도횡성교육지원청',
        '둔내초등학교': '강원특별자치도횡성교육지원청',
        '서원중학교': '강원특별자치도횡성교육지원청',
        '서원초등학교': '강원특별자치도횡성교육지원청',
        '성남초등학교': '강원특별자치도횡성교육지원청',
        '성북초등학교': '강원특별자치도횡성교육지원청',
        '수백초등학교': '강원특별자치도횡성교육지원청',
        '안흥고등학교': '강원특별자치도횡성교육지원청',
        '안흥중학교': '강원특별자치도횡성교육지원청',
        '안흥초등학교': '강원특별자치도횡성교육지원청',
        '안흥초등학교덕천분교': '강원특별자치도횡성교육지원청',
        '우천중학교': '강원특별자치도횡성교육지원청',
        '우천초등학교': '강원특별자치도횡성교육지원청',
        '유현초등학교': '강원특별자치도횡성교육지원청',
        '정금초등학교': '강원특별자치도횡성교육지원청',
        '창림초등학교': '강원특별자치도횡성교육지원청',
        '청일중학교': '강원특별자치도횡성교육지원청',
        '청일초등학교': '강원특별자치도횡성교육지원청',
        '춘당초등학교': '강원특별자치도횡성교육지원청',
        '현천고등학교': '강원특별자치도횡성교육지원청',
        '횡성고등학교': '강원특별자치도횡성교육지원청',
        '횡성여자고등학교': '강원특별자치도횡성교육지원청',
        '횡성중학교': '강원특별자치도횡성교육지원청',
        '횡성초등학교': '강원특별자치도횡성교육지원청',

    }
    # 강원도 중고등학교와 교육지원청 매핑
    # 학교명 키워드 → 교육지원청
    MIDDLE_HIGH_SCHOOL_REGION_MAP = {
        # 춘천
        '춘천': '강원특별자치도춘천교육지원청',
        # 원주
        '원주': '강원특별자치도원주교육지원청',
        # 강릉
        '강릉': '강원특별자치도강릉교육지원청',
        '경포': '강원특별자치도강릉교육지원청',
        '명륜': '강원특별자치도강릉교육지원청',
        '옥계': '강원특별자치도강릉교육지원청',
        # 동해
        '동해': '강원특별자치도동해교육지원청',
        '묵호': '강원특별자치도동해교육지원청',
        '북평': '강원특별자치도동해교육지원청',
        '하랑': '강원특별자치도동해교육지원청',
        '예람': '강원특별자치도동해교육지원청',
        # 태백
        '태백': '강원특별자치도태백교육지원청',
        # 속초/양양
        '속초': '강원특별자치도속초양양교육지원청',
        '양양': '강원특별자치도속초양양교육지원청',
        # 삼척
        '삼척': '강원특별자치도삼척교육지원청',
        '근덕': '강원특별자치도삼척교육지원청',
        '도계': '강원특별자치도삼척교육지원청',
        # 홍천
        '홍천': '강원특별자치도홍천교육지원청',
        # 횡성
        '횡성': '강원특별자치도횡성교육지원청',
        '우천': '강원특별자치도횡성교육지원청',
        # 영월
        '영월': '강원특별자치도영월교육지원청',
        # 평창
        '평창': '강원특별자치도평창교육지원청',
        '진부': '강원특별자치도평창교육지원청',
        # 정선
        '정선': '강원특별자치도정선교육지원청',
        '사북': '강원특별자치도정선교육지원청',
        # 철원
        '철원': '강원특별자치도철원교육지원청',
        # 화천
        '화천': '강원특별자치도화천교육지원청',
        # 양구
        '양구': '강원특별자치도양구교육지원청',
        # 인제
        '인제': '강원특별자치도인제교육지원청',
        # 고성
        '고성': '강원특별자치도고성교육지원청',
        # 기타 유명 중고등학교
        '하슬라': '강원특별자치도강릉교육지원청',
        '청아': '강원특별자치도춘천교육지원청',
        '제일': '강원특별자치도강릉교육지원청',
    }

    # 강원도 학교 데이터베이스 (중복 학교명 포함)
    # 형식: {학교명: {교육청: 정식학교명}}
    GANGWON_SCHOOL_DATABASE = {
        # 중복 학교명 - 원당초등학교
        '원당초등학교': {
            '강원특별자치도홍천교육지원청': '홍천원당초등학교',
            '강원특별자치도양구교육지원청': '양구원당초등학교',
        },
        '원당초': {
            '강원특별자치도홍천교육지원청': '홍천원당초등학교',
            '강원특별자치도양구교육지원청': '양구원당초등학교',
        },
        # 중복 학교명 - 신동초등학교
        '신동초등학교': {
            '강원특별자치도춘천교육지원청': '춘천신동초등학교',
            '강원특별자치도삼척교육지원청': '삼척신동초등학교',
        },
        '신동초': {
            '강원특별자치도춘천교육지원청': '춘천신동초등학교',
            '강원특별자치도삼척교육지원청': '삼척신동초등학교',
        },
        # 중복 학교명 - 반곡초등학교
        '반곡초등학교': {
            '강원특별자치도원주교육지원청': '원주반곡초등학교',
            '강원특별자치도홍천교육지원청': '홍천반곡초등학교',
        },
        '반곡초': {
            '강원특별자치도원주교육지원청': '원주반곡초등학교',
            '강원특별자치도홍천교육지원청': '홍천반곡초등학교',
        },
        # 중복 학교명 - 교동초등학교
        '교동초등학교': {
            '강원특별자치도춘천교육지원청': '춘천교동초등학교',
            '강원특별자치도원주교육지원청': '원주교동초등학교',
            '강원특별자치도강릉교육지원청': '강릉교동초등학교',
            '강원특별자치도속초양양교육지원청': '속초교동초등학교',
        },
        '교동초': {
            '강원특별자치도춘천교육지원청': '춘천교동초등학교',
            '강원특별자치도원주교육지원청': '원주교동초등학교',
            '강원특별자치도강릉교육지원청': '강릉교동초등학교',
            '강원특별자치도속초양양교육지원청': '속초교동초등학교',
        },
        # 중복 학교명 - 속초초등학교
        '속초초등학교': {
            '강원특별자치도속초양양교육지원청': '속초초등학교',  # 속초는 그대로
            '강원특별자치도홍천교육지원청': '홍천속초초등학교',
        },
        '속초초': {
            '강원특별자치도속초양양교육지원청': '속초초등학교',
            '강원특별자치도홍천교육지원청': '홍천속초초등학교',
        },
        # 중복 학교명 - 중앙초등학교
        '중앙초등학교': {
            '강원특별자치도춘천교육지원청': '춘천중앙초등학교',
            '강원특별자치도원주교육지원청': '원주중앙초등학교',
            '강원특별자치도강릉교육지원청': '강릉중앙초등학교',
            '강원특별자치도속초양양교육지원청': '속초중앙초등학교',
            '강원특별자치도삼척교육지원청': '삼척중앙초등학교',
            '강원특별자치도동해교육지원청': '동해중앙초등학교',  # 동해중앙초는 기본 학교명
        },
        '중앙초': {
            '강원특별자치도춘천교육지원청': '춘천중앙초등학교',
            '강원특별자치도원주교육지원청': '원주중앙초등학교',
            '강원특별자치도강릉교육지원청': '강릉중앙초등학교',
            '강원특별자치도속초양양교육지원청': '속초중앙초등학교',
            '강원특별자치도삼척교육지원청': '삼척중앙초등학교',
            '강원특별자치도동해교육지원청': '동해중앙초등학교',
        },
        # 중복 학교명 - 조양초등학교
        '조양초등학교': {
            '강원특별자치도춘천교육지원청': '춘천조양초등학교',
            '강원특별자치도속초양양교육지원청': '속초조양초등학교',
        },
        '조양초': {
            '강원특별자치도춘천교육지원청': '춘천조양초등학교',
            '강원특별자치도속초양양교육지원청': '속초조양초등학교',
        },
        # 중복 학교명 - 남산초등학교
        '남산초등학교': {
            '강원특별자치도춘천교육지원청': '춘천남산초등학교',
            '강원특별자치도강릉교육지원청': '강릉남산초등학교',
            '강원특별자치도홍천교육지원청': '홍천남산초등학교',
        },
        '남산초': {
            '강원특별자치도춘천교육지원청': '춘천남산초등학교',
            '강원특별자치도강릉교육지원청': '강릉남산초등학교',
            '강원특별자치도홍천교육지원청': '홍천남산초등학교',
        },
    }

    # 지역명 기반 학교명 검색 (역매핑)
    # 형식: {지역명: {학교약칭: 정식학교명}}
    REGION_SCHOOL_MAP = {
        '홍천': {
            '원당초': '홍천원당초등학교',
            '원당초등학교': '홍천원당초등학교',
            '반곡초': '홍천반곡초등학교',
            '반곡초등학교': '홍천반곡초등학교',
            '속초초': '홍천속초초등학교',
            '속초초등학교': '홍천속초초등학교',
            '남산초': '홍천남산초등학교',
            '남산초등학교': '홍천남산초등학교',
        },
        '양구': {
            '원당초': '양구원당초등학교',
            '원당초등학교': '양구원당초등학교',
        },
        '춘천': {
            '신동초': '춘천신동초등학교',
            '신동초등학교': '춘천신동초등학교',
            '교동초': '춘천교동초등학교',
            '교동초등학교': '춘천교동초등학교',
            '중앙초': '춘천중앙초등학교',
            '중앙초등학교': '춘천중앙초등학교',
            '조양초': '춘천조양초등학교',
            '조양초등학교': '춘천조양초등학교',
            '남산초': '춘천남산초등학교',
            '남산초등학교': '춘천남산초등학교',
        },
        '삼척': {
            '신동초': '삼척신동초등학교',
            '신동초등학교': '삼척신동초등학교',
            '중앙초': '삼척중앙초등학교',
            '중앙초등학교': '삼척중앙초등학교',
        },
        '원주': {
            '반곡초': '원주반곡초등학교',
            '반곡초등학교': '원주반곡초등학교',
            '교동초': '원주교동초등학교',
            '교동초등학교': '원주교동초등학교',
            '중앙초': '원주중앙초등학교',
            '중앙초등학교': '원주중앙초등학교',
        },
        '강릉': {
            '교동초': '강릉교동초등학교',
            '교동초등학교': '강릉교동초등학교',
            '중앙초': '강릉중앙초등학교',
            '중앙초등학교': '강릉중앙초등학교',
            '남산초': '강릉남산초등학교',
            '남산초등학교': '강릉남산초등학교',
        },
        '속초': {
            '교동초': '속초교동초등학교',
            '교동초등학교': '속초교동초등학교',
            '중앙초': '속초중앙초등학교',
            '중앙초등학교': '속초중앙초등학교',
            '조양초': '속초조양초등학교',
            '조양초등학교': '속초조양초등학교',
            '속초초': '속초초등학교',  # 속초는 그대로
            '속초초등학교': '속초초등학교',
        },
        '동해': {
            '중앙초': '동해중앙초등학교',
            '중앙초등학교': '동해중앙초등학교',
        },
    }

    # 학교 약칭 매핑 (순서 중요: 긴 것부터)
    SCHOOL_ABBR_MAPPINGS = {
        '공고': '공업고등학교',
        '정산고': '정보산업고등학교',
        '산과고': '산업과학고등학교',
        '여고': '여자고등학교',
        '여중': '여자중학교',
        '남고': '남자고등학교',
        '남중': '남자중학교',
        '상고': '상업고등학교',
        '농고': '농업고등학교',
        '공고': '공업고등학교',
        '과학고': '과학고등학교',
        '외고': '외국어고등학교',
        '예고': '예술고등학교',
        '체고': '체육고등학교',
        '고': '고등학교',
        '중': '중학교',
        '초': '초등학교',
    }

    # 직위명 정규화 매핑
    POSITION_NORMALIZATION = {
        '초등학교 교감': '교감',
        '중등학교 교감': '교감',
        '초등학교교감': '교감',
        '중등학교교감': '교감',
        '초등학교 교사': '교사',
        '중등학교 교사': '교사',
        '초등학교교사': '교사',
        '중등학교교사': '교사',
        '특수학교교사(초등)': '특수교사',
        '특수학교교사(중등)': '특수교사',
        '특수학교 교사(초등)': '특수교사',
        '특수학교 교사(중등)': '특수교사',
        '특수학교교사': '특수교사',
        '유치원 원감': '유치원감',
        '유치원원감': '유치원감',
    }

    def __init__(self, use_ai: bool = False, ai_matcher=None, use_web_search: bool = True):
        """
        Args:
            use_ai: AI 기반 학교명 검증 사용 여부
            ai_matcher: GeminiMatcher 인스턴스 (use_ai=True일 때 필요)
            use_web_search: 웹 검색 기반 학교명 → 교육청 매핑 사용 여부
        """
        self.use_ai = use_ai
        self.ai_matcher = ai_matcher
        self.use_web_search = use_web_search

        # 학교명 → 교육청 매핑 캐시 (웹 검색 결과 저장)
        self.school_edu_office_cache = {}

        # 학습된 매핑 파일 경로
        self.learned_mappings_file = 'learned_school_mappings.json'
        self.failed_mappings_log = 'failed_mappings.log'

        # 학습된 매핑 자동 로드
        self.load_learned_mappings()

        if use_ai and not ai_matcher:
            try:
                from ai_matcher import GeminiMatcher
                import os
                self.ai_matcher = GeminiMatcher(api_key=os.getenv('GEMINI_API_KEY'))
                print("🤖 KFTA Parser: AI 모드 활성화")
            except Exception as e:
                print(f"⚠️  AI 모드 초기화 실패: {str(e)}")
                self.use_ai = False

    def load_learned_mappings(self):
        """학습된 학교→교육청 매핑을 JSON 파일에서 로드"""
        if os.path.exists(self.learned_mappings_file):
            try:
                with open(self.learned_mappings_file, 'r', encoding='utf-8') as f:
                    learned = json.load(f)
                    self.school_edu_office_cache.update(learned)
                    print(f"📚 학습된 매핑 {len(learned)}개 로드 완료")
            except Exception as e:
                print(f"⚠️  학습된 매핑 로드 실패: {str(e)}")
        else:
            print("📚 학습된 매핑 파일 없음 (새로 시작)")

    def save_learned_mapping(self, school_name: str, education_office: str):
        """성공한 매핑을 JSON 파일에 저장 (자동 학습)"""
        if not school_name or not education_office:
            return

        # 이미 GANGWON_ALL_SCHOOLS에 있으면 저장 안 함 (중복 방지)
        if school_name in self.GANGWON_ALL_SCHOOLS:
            return

        # 캐시에 추가
        self.school_edu_office_cache[school_name] = education_office

        # 파일에 저장
        try:
            # 기존 데이터 로드
            if os.path.exists(self.learned_mappings_file):
                with open(self.learned_mappings_file, 'r', encoding='utf-8') as f:
                    learned = json.load(f)
            else:
                learned = {}

            # 새로운 매핑 추가
            learned[school_name] = education_office

            # 파일에 저장
            with open(self.learned_mappings_file, 'w', encoding='utf-8') as f:
                json.dump(learned, f, ensure_ascii=False, indent=2)

            print(f"  💾 학습 저장: '{school_name}' → '{education_office}'")

        except Exception as e:
            print(f"⚠️  매핑 저장 실패: {str(e)}")

    def log_failed_mapping(self, school_name: str, hints: dict = None):
        """실패한 매핑을 로그 파일에 기록"""
        if not school_name:
            return

        try:
            timestamp = datetime.now().strftime("%Y-%m-%d %H:%M:%S")
            hints_str = f"regions={hints.get('regions', [])}, edu_offices={hints.get('education_offices', [])}" if hints else "no hints"

            log_entry = f"[{timestamp}] 매핑 실패: '{school_name}' | {hints_str}\n"

            with open(self.failed_mappings_log, 'a', encoding='utf-8') as f:
                f.write(log_entry)

        except Exception as e:
            print(f"⚠️  실패 로그 기록 실패: {str(e)}")

    def is_region_name_only(self, text: str) -> bool:
        """텍스트가 지역명만 있는지 확인"""
        if pd.isna(text) or str(text).strip() == "":
            return False

        text = str(text).strip()

        # 지역명만 있는 패턴 (예: "춘천", "원주" 등)
        for region in self.GANGWON_REGIONS.keys():
            if text == region or text.endswith(region):
                return True

        return False

    def remove_region_prefix_from_school_name(self, school_name: str) -> str:
        """
        학교명 앞의 지역명 제거
        예: "춘천남산초등학교" → "남산초등학교"
            "강릉중앙초등학교" → "중앙초등학교"

        Args:
            school_name: 학교명

        Returns:
            지역명이 제거된 학교명
        """
        if pd.isna(school_name) or not school_name:
            return school_name

        school_name = str(school_name).strip()

        # 강원도 지역명을 길이 역순으로 정렬 (긴 지역명부터 매칭)
        sorted_regions = sorted(self.GANGWON_REGIONS.keys(), key=len, reverse=True)

        for region in sorted_regions:
            # Fix 2: 지역명 뒤에 공백이 있는 경우에만 제거 (예: "춘천 " -> "")
            # "춘천초등학교" -> "춘천초등학교" (유지)
            # "춘천 초등학교" -> "초등학교" (제거)
            prefix_with_space = region + " "
            if school_name.startswith(prefix_with_space):
                return school_name[len(prefix_with_space):].strip()
            
            # 예외: "철원 새들유치원" -> "새들유치원" (이미 위 로직으로 커버됨)
            
            # 기존 로직 (지역명만 붙어있는 경우)은 제거하지 않음으로 변경됨
            # if school_name.startswith(region): ...

        return school_name

    def is_duplicate_school_name(self, school_name: str) -> bool:
        """
        중복 학교명인지 확인 (GANGWON_SCHOOL_DATABASE에 정의된)

        Args:
            school_name: 학교명 (예: "남산초등학교", "중앙초")

        Returns:
            중복 학교명이면 True
        """
        if pd.isna(school_name) or not school_name:
            return False

        school_name = str(school_name).strip()

        # GANGWON_SCHOOL_DATABASE에서 확인
        if school_name in self.GANGWON_SCHOOL_DATABASE:
            # 2개 이상의 교육청에 매핑되어 있으면 중복
            if len(self.GANGWON_SCHOOL_DATABASE[school_name]) > 1:
                return True

        return False

    def extract_region_from_text(self, text: str) -> Optional[str]:
        """텍스트에서 강원도 지역명 추출"""
        if pd.isna(text):
            return None

        text = str(text)

        for region in self.GANGWON_REGIONS.keys():
            if region in text:
                return region

        return None

    def get_education_office(self, region: str) -> str:
        """지역명으로 교육지원청명 가져오기"""
        # Fix 4: 타시도의 경우 교육지원청은 공란으로
        if region not in self.GANGWON_REGIONS:
            return ''
            
        return self.GANGWON_REGIONS.get(region, f'강원특별자치도{region}교육지원청')

    def parse_school_with_position(self, text: str) -> tuple:
        """
        "xxx병설유 교사" 같은 패턴을 학교명과 직위로 분리

        Args:
            text: 텍스트 (예: "xxx병설유 교사", "OO초 교감", "춘천중학교 교장")

        Returns:
            (학교명, 직위) 튜플
        """
        if pd.isna(text) or not text:
            return ('', '')

        text = str(text).strip()

        # 직위 키워드 목록
        position_keywords = ['교사', '교감', '교장', '원감', '원장', '수석교사']

        # 패턴 1: "xxx병설유 교사" 형식
        # 예: "춘천병설유 교사" → ("춘천병설유치원", "교사")
        for keyword in position_keywords:
            if f' {keyword}' in text:  # 공백 + 직위
                parts = text.split(f' {keyword}')
                school_part = parts[0].strip()

                # 학교명 확장
                expanded_school = self.expand_school_abbreviation(school_part)
                return (expanded_school, keyword)

            # 패턴 2: 공백 없이 붙어있는 경우
            if text.endswith(keyword):
                # "춘천중학교교사" → ("춘천중학교", "교사")
                school_part = text[:-len(keyword)].strip()

                # 단, 학교 패턴이 있는지 확인
                if self.is_school_name(school_part):
                    expanded_school = self.expand_school_abbreviation(school_part)
                    return (expanded_school, keyword)

        # 직위가 없으면 전체를 학교명으로 반환
        return (text, '')

    def search_school_education_office(self, school_name: str) -> str:
        """
        캐시를 통해 학교명에 대한 교육지원청 찾기
        (향후 웹 검색 기능 추가 예정)

        Args:
            school_name: 학교명 (예: "남산초등학교", "사북고등학교")

        Returns:
            교육지원청명 (찾지 못하면 빈 문자열)
        """
        if pd.isna(school_name) or not school_name:
            return ''

        school_name = str(school_name).strip()

        # 캐시 확인
        if school_name in self.school_edu_office_cache:
            cached_result = self.school_edu_office_cache[school_name]
            if cached_result:
                print(f"  💾 캐시 적중: '{school_name}' → '{cached_result}'")
            return cached_result

        # TODO: 향후 웹 검색 기능 추가
        # 현재는 빈 문자열 반환
        return ''

    def find_education_office_for_school(self, school_name: str, hints: dict = None) -> str:
        """
        학교명에서 교육지원청 찾기 (초/중/고/유치원 모두 지원)

        Args:
            school_name: 학교명 (예: "홍천여중", "강릉제일고", "춘천남산초등학교", "속초유치원")
            hints: 행 전체에서 추출한 힌트 정보 (regions, education_offices)

        Returns:
            교육지원청명 (예: "강원특별자치도홍천교육지원청")
        """
        if pd.isna(school_name) or not school_name:
            return ''

        school_name = str(school_name).strip()

        # 0. GANGWON_ALL_SCHOOLS에서 완전 일치 검색 (최우선)
        if school_name in self.GANGWON_ALL_SCHOOLS:
            result = self.GANGWON_ALL_SCHOOLS[school_name]
            print(f"  ✅ 학교 DB 매칭: '{school_name}' → '{result}'")
            self.school_edu_office_cache[school_name] = result  # 캐시 저장
            return result

        # 1. MIDDLE_HIGH_SCHOOL_REGION_MAP에서 중고등학교 키워드 매칭
        # 긴 키워드부터 매칭 (예: "강릉제일"이 "강릉"보다 먼저)
        sorted_keywords = sorted(self.MIDDLE_HIGH_SCHOOL_REGION_MAP.keys(),
                                key=len, reverse=True)

        for keyword in sorted_keywords:
            if keyword in school_name:
                result = self.MIDDLE_HIGH_SCHOOL_REGION_MAP[keyword]
                self.save_learned_mapping(school_name, result)  # 자동 학습
                return result

        # 2. 초등학교/유치원: 학교명 앞부분에서 지역명 추출
        # 예: "춘천남산초등학교" → "춘천" 추출
        # 예: "강원특별자치도춘천교육지원청속초유치원" → "속초" 추출

        # 강원도 지역명을 길이 역순으로 정렬 (긴 지역명부터 매칭)
        sorted_regions = sorted(self.GANGWON_REGIONS.keys(), key=len, reverse=True)

        # 2-1. 학교명이 지역명으로 시작하는지 확인
        for region in sorted_regions:
            if school_name.startswith(region):
                result = self.get_education_office(region)
                self.save_learned_mapping(school_name, result)  # 자동 학습
                return result

        # 2-2. 학교명에 지역명이 포함되어 있는지 확인 (앞부분 우선)
        for region in sorted_regions:
            if region in school_name:
                # 중복 학교명 데이터베이스에서 확인
                if school_name in self.GANGWON_SCHOOL_DATABASE:
                    edu_office = self.get_education_office(region)
                    school_mappings = self.GANGWON_SCHOOL_DATABASE[school_name]
                    if edu_office in school_mappings:
                        self.save_learned_mapping(school_name, edu_office)  # 자동 학습
                        return edu_office
                else:
                    # 일반 학교명인 경우 첫 번째 매칭된 지역 반환
                    # 단, 학교명 앞쪽에서 발견된 경우에만
                    region_index = school_name.find(region)
                    if region_index <= 10:  # 학교명 앞부분 10자 이내
                        result = self.get_education_office(region)
                        self.save_learned_mapping(school_name, result)  # 자동 학습
                        return result

        # 3. Fallback: hints 정보에서 교육청 추출
        if hints:
            # 3-1. 교육청이 직접 명시된 경우
            if hints.get('education_offices'):
                result = hints['education_offices'][0]
                self.save_learned_mapping(school_name, result)  # 자동 학습
                return result

            # 3-2. 지역명이 있는 경우
            if hints.get('regions'):
                result = self.get_education_office(hints['regions'][0])
                self.save_learned_mapping(school_name, result)  # 자동 학습
                return result

        # 4. Fallback: 학교명에서 2글자 지역명 추출 시도 (앞 2글자)
        # 예: "남산초등학교" → 실패하지만, "춘천남산초등학교"라면 이미 위에서 처리됨
        # 하지만 "OO초등학교" 형식이라면 포기
        if len(school_name) >= 4:
            # 앞 2글자가 지역명인지 확인
            potential_region = school_name[:2]
            if potential_region in self.GANGWON_REGIONS:
                result = self.get_education_office(potential_region)
                self.school_edu_office_cache[school_name] = result  # 캐시 저장
                return result

            # 앞 3글자가 지역명인지 확인
            if len(school_name) >= 5:
                potential_region = school_name[:3]
                if potential_region in self.GANGWON_REGIONS:
                    result = self.get_education_office(potential_region)
                    self.school_edu_office_cache[school_name] = result  # 캐시 저장
                    return result

        # 5. 캐시 검색 (이미 검색한 학교명)
        cached = self.search_school_education_office(school_name)
        if cached:
            return cached

        # 6. 모든 방법 실패 → 로그 기록
        self.log_failed_mapping(school_name, hints)
        return ''

    def lookup_school_with_region(self, region: str, school_name: str) -> tuple:
        """
        지역명과 학교명을 사용하여 정확한 학교명과 교육청 조회

        Args:
            region: 지역명 (예: "인제", "춘천", "양구")
            school_name: 학교명 또는 약칭 (예: "원당초", "월학초유")

        Returns:
            (교육청명, 정식학교명) 튜플
        """
        if not region or not school_name:
            return ('', school_name if school_name else '')

        # 1. 지역명에서 교육청 찾기
        education_office = self.get_education_office(region)

        # 2. 학교 약칭 확장 (예: "월학초유" => "월학초등학교")
        expanded_school = self.expand_school_abbreviation(school_name)

        # 3. REGION_SCHOOL_MAP에서 지역별 학교명 검색
        if region in self.REGION_SCHOOL_MAP:
            region_schools = self.REGION_SCHOOL_MAP[region]

            # 확장된 학교명으로 먼저 검색
            if expanded_school in region_schools:
                return (education_office, region_schools[expanded_school])

            # 원본 학교명으로 검색
            if school_name in region_schools:
                return (education_office, region_schools[school_name])

        # 4. GANGWON_SCHOOL_DATABASE에서 중복 학교명 검색
        if expanded_school in self.GANGWON_SCHOOL_DATABASE:
            school_mappings = self.GANGWON_SCHOOL_DATABASE[expanded_school]
            if education_office in school_mappings:
                return (education_office, school_mappings[education_office])

        if school_name in self.GANGWON_SCHOOL_DATABASE:
            school_mappings = self.GANGWON_SCHOOL_DATABASE[school_name]
            if education_office in school_mappings:
                return (education_office, school_mappings[education_office])

        # 5. 매핑이 없으면 확장된 학교명 그대로 반환
        return (education_office, expanded_school)

    def is_school_name(self, text: str) -> bool:
        """
        텍스트가 학교명인지 판단

        Args:
            text: 확인할 텍스트

        Returns:
            학교명이면 True, 아니면 False
        """
        if pd.isna(text) or not text:
            return False

        text = str(text).strip()

        # 1. 블랙리스트 체크 - 명확히 학교명이 아닌 것들
        # 과목명
        subject_blacklist = [
            '국어', '영어', '수학', '과학', '사회', '역사', '도덕', '체육',
            '음악', '미술', '실과', '기술', '가정', '한문', '정보',
            '물리', '화학', '생물', '지구과학', '생명과학', '윤리',
            '지리', '경제', '정치', '법과사회', '한국사', '세계사',
            '문학', '독서', '작문', '문법', '화법', '논술',
            '통합과학', '통합사회', '진로', '창체'
        ]

        # 직위/직종 관련 용어
        position_blacklist = [
            '교사', '교감', '교장', '원감', '원장', '수석교사',
            '초등교사', '중등교사', '고등교사', '유치원교사',
            '초등학교교사', '중등학교교사', '고등학교교사',
            '특수교사', '보건교사', '영양교사', '사서교사',
            '전문상담교사', '실기교사', '기간제교사',
            '현 소 속', '발령', '전보', '승진', '임용'
        ]

        # 기타 제외 용어
        other_blacklist = [
            '신규', '재임용', '명예퇴직', '정년퇴직', '휴직', '복직',
            '기타', '없음', '해당없음', '비고', '특이사항'
        ]

        # 블랙리스트 확인 (정확히 일치하거나 단독으로 나타나는 경우)
        for blacklist_item in subject_blacklist + position_blacklist + other_blacklist:
            if text == blacklist_item:
                return False
            # 직위 관련 용어가 포함되어 있고 학교 패턴이 없으면 제외
            if blacklist_item in position_blacklist and blacklist_item in text:
                # "중등학교교사", "초등교사" 같은 경우 제외
                if not any(school_word in text for school_word in ['초등학교', '중학교', '고등학교', '유치원']):
                    return False

        # 2. 학교명 패턴 체크 (초등학교, 중학교, 고등학교, 유치원 등)
        school_patterns = [
            '초등학교', '중학교', '고등학교', '유치원', '학교',
            '초교', '중교', '고교',
            '여중', '여고', '남중', '남고',
            '공고', '상고', '농고', '정산고', '산과고',
        ]

        # 패턴 매칭 - 단순 포함이 아니라 학교명 패턴인지 확인
        for pattern in school_patterns:
            if pattern in text:
                # "중등학교교사"처럼 직위가 붙은 경우 제외
                if any(pos_word in text for pos_word in ['교사', '교감', '교장', '원감', '원장']):
                    # 단, "OO중학교 교사"처럼 공백이 있으면 학교명으로 인정
                    if ' ' in text:
                        school_part = text.split()[0]
                        if pattern in school_part:
                            return True
                    continue
                return True

        # 3. 끝나는 패턴 확인 (예: "춘천중", "원주고", "남산초", "속초유")
        if text.endswith('초') or text.endswith('중') or text.endswith('고') or text.endswith('유'):
            # 단, 한 글자는 제외 (예: "초", "유"만 있는 경우)
            if len(text) > 1:
                # 과목명이 아닌지 확인 (예: "역사", "국어"는 제외)
                if text not in subject_blacklist:
                    return True

        # 4. 병설유치원 패턴
        if '병설유' in text or '초유' in text:
            return True

        # 5. 정규표현식 패턴: 지역명(학교급) 형식
        # 예: 인제(고), 춘천(중), 속초(초), 원주(유)
        import re
        pattern = r'^[\w가-힣]+\((초|중|고|유)\)$'
        if re.match(pattern, text):
            return True

        return False

    def expand_school_abbreviation(self, school_name: str) -> str:
        """
        학교 약칭을 정식 명칭으로 확장
        예: "춘천공고" → "춘천공업고등학교"
            "원주여고" → "원주여자고등학교"
            "춘천OO초" → "춘천OO초등학교"
            "신림초/교사" → "신림초등학교"
            "OO초병설유치원" → "OO초등학교"
            "속초유" → "속초유치원" (예외)
            "인제(고)" → "인제고등학교"
            "춘천(중)" → "춘천중학교"
            "속초(유)" → "속초유치원"
        """
        if pd.isna(school_name) or not school_name:
            return school_name

        school_name = str(school_name).strip()

        # 0-1. 분교 표기 처리: 학교명(분교명) 형식
        # 예: 남산(서천)초등학교 → 남산초등학교 서천분교
        import re
        branch_pattern = r'^([\w가-힣]+)\(([\w가-힣]+)\)(초등학교|중학교|고등학교)$'
        branch_match = re.match(branch_pattern, school_name)
        if branch_match:
            main_school = branch_match.group(1)
            branch_name = branch_match.group(2)
            school_type = branch_match.group(3)
            return f"{main_school}{school_type} {branch_name}분교"

        # 0-2. 정규표현식 패턴 처리: 지역명(학교급) 형식
        # 예: 인제(고) → 인제고등학교
        pattern = r'^([\w가-힣]+)\((초|중|고|유)\)$'
        match = re.match(pattern, school_name)
        if match:
            base_name = match.group(1)
            school_type = match.group(2)

            type_mapping = {
                '초': '초등학교',
                '중': '중학교',
                '고': '고등학교',
                '유': '유치원'
            }

            return base_name + type_mapping.get(school_type, '')

        # 1. /교사, /교장 등 직위 표기 제거
        if '/' in school_name:
            school_name = school_name.split('/')[0].strip()

        # 1.5. 특정 유치원 약칭 처리
        # "새들유" → "새들유치원"
        # "홍천남산유" → "홍천남산유치원"
        # "OO유" → "OO유치원" (단, 병설유, 초유, 속초유 제외)
        if school_name.endswith('유') and not school_name.endswith('병설유') and not school_name.endswith('초유') and school_name != '속초유':
            # 2글자 이상이면 유치원으로 확장
            if len(school_name) >= 2:
                return school_name + '치원'

        # 2. 병설유치원 처리
        # OO초병설유치원 → OO초등학교
        # OO초 병설유치원 → OO초등학교
        # OO초 병설유 → OO초등학교
        # OO초병설유 → OO초등학교
        # OO초유 → OO초등학교 (단, 속초유는 예외)
        byeongseol_patterns = [
            '병설유치원',
            ' 병설유치원',
            ' 병설유',
            '병설유',
        ]

        for pattern in byeongseol_patterns:
            if pattern in school_name:
                school_name = school_name.replace(pattern, '')
                # 초로 끝나면 초등학교로 확장
                if school_name.endswith('초'):
                    return school_name + '등학교'
                return school_name

        # OO초유 → OO초등학교 (단, 속초유는 예외)
        if school_name.endswith('초유') and not school_name == '속초유':
            return school_name[:-2] + '초등학교'

        # 속초유 → 속초유치원 (예외 처리)
        if school_name == '속초유':
            return '속초유치원'

        # 3. 약칭 매핑을 길이 순으로 정렬 (긴 것부터 매칭)
        sorted_mappings = sorted(self.SCHOOL_ABBR_MAPPINGS.items(),
                                key=lambda x: len(x[0]),
                                reverse=True)

        for abbr, full_name in sorted_mappings:
            if school_name.endswith(abbr):
                # 약칭을 정식 명칭으로 교체
                base_name = school_name[:-len(abbr)]
                return base_name + full_name

        return school_name

    def parse_abbreviated_school_format(self, school_text: str) -> tuple:
        """
        약식 학교명 파싱: "□□ OO초" 형식

        Args:
            school_text: "춘천 남산초" 또는 "춘천남산초" 형식

        Returns:
            (교육청명, 학교풀네임) 튜플
            예: ("강원특별자치도춘천교육지원청", "남산초등학교")

        중요: 지역명 뒤에 공백이 있을 때만 지역명을 교육청으로 분리
              예: "춘천 남산초" → (춘천교육청, "남산초등학교")
                  "동해중앙초" → ("", "동해중앙초등학교")
                  "동해중학교" → ("", "동해중학교")
        """
        if pd.isna(school_text) or not school_text:
            return ('', school_text)

        school_text = str(school_text).strip()

        region = None
        school_name = school_text
        education_office = ''

        # 강원도 지역명 찾기 (공백이 있는 경우만 분리)
        for region_name in self.GANGWON_REGIONS.keys():
            if school_text.startswith(region_name + ' '):  # 지역명 뒤에 공백이 있는 경우만
                region = region_name
                # 지역명과 공백 제거
                remainder = school_text[len(region_name):].strip()
                if remainder:
                    school_name = remainder
                    education_office = self.get_education_office(region)
                break

        # 학교 약칭 확장
        school_name = self.expand_school_abbreviation(school_name)

        return (education_office, school_name)

    def normalize_position(self, position: str) -> str:
        """
        직위명 정규화

        Args:
            position: 원본 직위명

        Returns:
            정규화된 직위명
        """
        if pd.isna(position) or not position:
            return position

        position = str(position).strip()

        # 정규화 매핑에서 찾기
        return self.POSITION_NORMALIZATION.get(position, position)

    def verify_and_expand_with_ai(self, school_name: str) -> tuple:
        """
        AI를 사용하여 학교명 검증 및 확장

        Args:
            school_name: 학교명

        Returns:
            (교육청명, 학교풀네임) 튜플
        """
        if not self.use_ai or not self.ai_matcher:
            # AI 미사용 시 기본 처리
            return self.parse_abbreviated_school_format(school_name)

        try:
            result = self.ai_matcher.verify_and_expand_school_name(
                school_name,
                self.GANGWON_REGIONS
            )

            full_name = result.get('full_name', school_name)
            education_office = result.get('education_office', '')
            confidence = result.get('confidence', 0)

            # 신뢰도가 낮으면 기본 처리로 fallback
            if confidence < 50:
                return self.parse_abbreviated_school_format(school_name)

            if confidence >= 70:
                print(f"  🤖 AI 검증: '{school_name}' → '{full_name}' (신뢰도: {confidence}%)")

            return (education_office, full_name)

        except Exception as e:
            print(f"  ⚠️  AI 검증 실패, 기본 모드로 전환: {str(e)}")
            return self.parse_abbreviated_school_format(school_name)

    def parse_bigo_for_kindergarten(self, bigo_text: str) -> tuple:
        """
        유치원 신규원감 발령의 비고란 파싱

        Args:
            bigo_text: 비고란 텍스트 (예: "인제 월학초유 교사", "강원특별자치도교육청 유아교육과")

        Returns:
            (현재교육청, 현재분회) 튜플
        """
        if pd.isna(bigo_text) or not bigo_text:
            return ('', '')

        bigo_text = str(bigo_text).strip()

        # 특수 케이스: "강원특별자치도교육청" 으로 시작하는 경우
        if bigo_text.startswith('강원특별자치도교육청'):
            return ('강원특별자치도춘천교육지원청', '강원특별자치도교육청')

        # 일반 케이스: "지역명 학교명 직위" 형식
        # 예: "인제 월학초유 교사"

        # 지역명 추출 (공백으로 구분)
        parts = bigo_text.split()
        if len(parts) >= 2:
            # 첫 번째 부분이 지역명인지 확인
            potential_region = parts[0]

            if potential_region in self.GANGWON_REGIONS:
                # 지역명 발견
                education_office = self.get_education_office(potential_region)

                # 나머지 부분에서 학교명 추출 (직위 제거)
                school_parts = parts[1:]
                school_text = ' '.join(school_parts)

                # 직위 키워드 제거 ("교사", "교장" 등)
                position_keywords = ['교사', '교장', '교감', '원장', '원감']
                for keyword in position_keywords:
                    if school_text.endswith(keyword):
                        school_text = school_text[:-len(keyword)].strip()
                        break

                # 학교명 확장 및 데이터베이스 검색
                edu_office, full_school_name = self.lookup_school_with_region(
                    potential_region,
                    school_text
                )

                return (edu_office, full_school_name)

        # 지역명 없이 학교명만 있는 경우 (예: "월학초유")
        # 직위 키워드 제거
        clean_text = bigo_text
        position_keywords = ['교사', '교장', '교감', '원장', '원감']
        for keyword in position_keywords:
            if clean_text.endswith(keyword):
                clean_text = clean_text[:-len(keyword)].strip()
                break

        # 학교 약칭 확장
        expanded_school = self.expand_school_abbreviation(clean_text)
        return ('', expanded_school)

    def is_valid_data_row(self, row: pd.Series, name_col_idx: int = 2) -> bool:
        """
        유효한 데이터 행인지 확인
        3번째 열(인덱스 2)이 헤더 키워드가 아니고 빈값도 아니면 True
        """
        if len(row) <= name_col_idx:
            return False

        value = row.iloc[name_col_idx]

        # NaN이거나 빈 문자열이면 False
        if pd.isna(value) or str(value).strip() == "":
            return False

        # 헤더 키워드 목록 (대응, 성명, 이름, 비고, 발령사항 등)
        header_keywords = ['성명', '이름', '대응', '대 응', '비고', '발령사항', '발령', '현소속', '현 소속']
        value_str = str(value).strip()

        # 헤더 키워드와 정확히 일치하면 헤더 행으로 판단
        if value_str in header_keywords:
            return False

        # 추가: 행 전체에서 여러 헤더 키워드가 나타나면 헤더로 판단
        header_count = 0
        for idx, cell in enumerate(row):
            if pd.notna(cell):
                cell_str = str(cell).strip()
                if cell_str in header_keywords:
                    header_count += 1

        # 3개 이상의 헤더 키워드가 있으면 헤더 행으로 판단
        if header_count >= 3:
            return False

        # 비고 컬럼 확인 (4번째 열, 인덱스 3)
        # 비고 컬럼이 "비고"라는 텍스트를 포함하면 헤더로 판단
        if len(row) > 3:
            bigo_value = str(row.iloc[3]).strip() if pd.notna(row.iloc[3]) else ""
            if '비고' in bigo_value and '전소속' in bigo_value:
                return False
            # 비고만 있어도 헤더일 가능성 높음
            if bigo_value == '비고':
                return False

        return True

    def extract_all_region_hints(self, row: pd.Series) -> dict:
        """
        행 데이터의 모든 필드에서 지역 힌트와 교육청 정보 추출

        Returns:
            {'regions': [지역명 리스트], 'education_offices': [교육청 리스트]}
        """
        regions = []
        education_offices = []

        # 모든 필드 스캔
        for idx, value in enumerate(row):
            if pd.isna(value):
                continue

            value_str = str(value).strip()

            # 교육청 키워드 발견
            if '교육청' in value_str or '교육지원청' in value_str:
                education_offices.append(value_str)

            # 지역명 발견
            for region in self.GANGWON_REGIONS.keys():
                if region in value_str:
                    regions.append(region)

        return {
            'regions': list(set(regions)),  # 중복 제거
            'education_offices': list(set(education_offices))
        }

    def parse_row_to_kfta(self, row: pd.Series) -> Dict[str, str]:
        """
        행 데이터를 강원교총 표준 형식으로 변환

        필드 매핑:
        - 3번째 필드(인덱스 2) → 이름 (성명)
        - 5번째 필드(인덱스 4) → 직위 (정규화 적용)
        - 6번째 필드(인덱스 5) → 발령분회 (약칭 확장)
        - 6번째 필드의 지역명 → 발령교육청
        - 8번째 필드(인덱스 7) → 현재분회 (조건부, 약칭 확장)
        - 9번째 필드(인덱스 8) → 현재교육청/현재분회 참고
        """
        # 먼저 행 전체에서 지역 및 교육청 힌트 추출
        hints = self.extract_all_region_hints(row)

        result = {
            '현재교육청': '',
            '현재분회': '',
            '이름': '',
            '발령교육청': '',
            '발령분회': '',
            '과목': '',
            '직위': '',
            '비고': '',
        }

        # 3번째 필드 → 이름 (성명) - 공백 제거
        if len(row) > 2:
            name = str(row.iloc[2]).strip() if pd.notna(row.iloc[2]) else ''
            # 이름 사이의 공백 제거 (예: "이  준" → "이준")
            result['이름'] = name.replace(' ', '')

        # 5번째 필드 → 직위 (정규화 적용)
        if len(row) > 4:
            position = str(row.iloc[4]).strip() if pd.notna(row.iloc[4]) else ''
            result['직위'] = self.normalize_position(position)

        # 6번째 필드 → 발령분회 및 발령교육청
        if len(row) > 5:
            field_6 = str(row.iloc[5]).strip() if pd.notna(row.iloc[5]) else ''

            # 먼저 학교명인지 확인
            if field_6 and self.is_school_name(field_6):
                # 중고등학교는 AI 검증 우선 시도 (use_ai=True인 경우)
                is_middle_high = '중학' in field_6 or '고등' in field_6 or field_6.endswith('중') or field_6.endswith('고')

                if is_middle_high and self.use_ai:
                    # AI로 학교명 검증 및 확장
                    edu_office, school_name = self.verify_and_expand_with_ai(field_6)
                    if edu_office:
                        result['발령교육청'] = edu_office
                        result['발령분회'] = school_name
                    else:
                        result['발령분회'] = school_name
                else:
                    # "□□ OO초" 형식 파싱
                    edu_office, school_name = self.parse_abbreviated_school_format(field_6)

                    if edu_office:  # 약식 형식으로 파싱 성공
                        result['발령교육청'] = edu_office
                        result['발령분회'] = school_name
                    else:
                        # 일반 형식 처리
                        result['발령분회'] = self.expand_school_abbreviation(field_6)

                        # 중고등학교 교육지원청 자동 매핑
                        if is_middle_high:
                            edu_office = self.find_education_office_for_school(result['발령분회'], hints)
                            if edu_office:
                                result['발령교육청'] = edu_office
                        else:
                            # 초등학교/유치원: 지역명 추출 → 발령교육청
                            # find_education_office_for_school() 사용 (hints fallback 포함)
                            edu_office = self.find_education_office_for_school(result['발령분회'], hints)
                            if edu_office:
                                result['발령교육청'] = edu_office
            # field_6이 학교명이 아니면 과목으로 간주
            elif field_6:
                result['과목'] = field_6

        # 8번째 필드 처리
        if len(row) > 7:
            field_8 = str(row.iloc[7]).strip() if pd.notna(row.iloc[7]) else ''

            # 유치원 신규원감 발령 특수 처리
            # 직위에 "유치원"과 "원감" 또는 "신규"가 포함된 경우
            is_kindergarten_principal = False
            if result['직위']:
                position_lower = result['직위'].lower()
                is_kindergarten = '유치원' in position_lower
                is_principal = '원감' in position_lower or '신규' in position_lower
                is_kindergarten_principal = is_kindergarten and is_principal

            if is_kindergarten_principal and len(row) > 9:
                # 유치원 신규원감의 경우 비고란(10번째 필드)에서 현재분회 정보 추출
                field_10 = str(row.iloc[9]).strip() if pd.notna(row.iloc[9]) else ''

                if field_10:
                    edu_office, school_name = self.parse_bigo_for_kindergarten(field_10)
                    if edu_office:
                        result['현재교육청'] = edu_office
                    if school_name:
                        result['현재분회'] = school_name

                    # 디버그 메시지 (선택사항)
                    # print(f"  🏫 유치원 신규원감 파싱: '{field_10}' → 교육청={edu_office}, 분회={school_name}")

            # 8번째 필드가 지역명만 있는 경우 (일반 케이스)
            elif self.is_region_name_only(field_8):
                # 10번째 필드(인덱스 9) 참고 - 비고란에 실제 학교명
                if len(row) > 9:
                    field_10 = str(row.iloc[9]).strip() if pd.notna(row.iloc[9]) else ''

                    if field_10 and self.is_school_name(field_10):  # 비고에 학교명이 있으면
                        # 학교 약칭 확장
                        school_name = self.expand_school_abbreviation(field_10)
                        result['현재분회'] = school_name

                        # 중고등학교 교육지원청 자동 매핑
                        edu_office = self.find_education_office_for_school(school_name, hints)
                        if edu_office:
                            result['현재교육청'] = edu_office
                        else:
                            # 매핑 실패 시 8번째 필드의 지역명 사용
                            region_8 = self.extract_region_from_text(field_8)
                            if region_8:
                                result['현재교육청'] = self.get_education_office(region_8)
                    else:
                        # 비고가 없으면 8번째 필드의 지역명만 사용
                        region_8 = self.extract_region_from_text(field_8)
                        if region_8:
                            result['현재교육청'] = self.get_education_office(region_8)
            # field_8이 학교명인지 확인
            elif field_8 and self.is_school_name(field_8):
                # 중고등학교는 AI 검증 우선 시도
                is_middle_high = '중학' in field_8 or '고등' in field_8 or field_8.endswith('중') or field_8.endswith('고')

                if is_middle_high and self.use_ai:
                    # AI로 학교명 검증 및 확장
                    edu_office, school_name = self.verify_and_expand_with_ai(field_8)
                    if edu_office:
                        result['현재교육청'] = edu_office
                        result['현재분회'] = school_name
                    else:
                        result['현재분회'] = school_name
                else:
                    # "□□ OO초" 형식 파싱
                    edu_office, school_name = self.parse_abbreviated_school_format(field_8)

                    if edu_office:  # 약식 형식으로 파싱 성공
                        result['현재교육청'] = edu_office
                        result['현재분회'] = school_name
                    else:
                        # 8번째 필드가 지역명만이 아니면 → 현재분회
                        result['현재분회'] = self.expand_school_abbreviation(field_8)

                        # 중고등학교 교육지원청 자동 매핑
                        if is_middle_high:
                            edu_office = self.find_education_office_for_school(result['현재분회'], hints)
                            if edu_office:
                                result['현재교육청'] = edu_office
                        else:
                            if edu_office:
                                result['현재교육청'] = edu_office

            # Fix 5 & 9: 타시도전입자 등 비고란에서 이전 학교명/교육청 파악
            # 현재분회/교육청이 비어있고 비고란(10번째 필드)이 있는 경우
            if (not result['현재분회'] or not result['현재교육청']) and len(row) > 9:
                field_10 = str(row.iloc[9]).strip() if pd.notna(row.iloc[9]) else ''
                
                if field_10:
                    # 1. "전입(이전학교)" 형식 파악
                    # 예: "전입(서울 OO초)", "타시도전입(OO중)"
                    
                    # 괄호 안의 내용 추출
                    import re
                    match = re.search(r'\((.*?)\)', field_10)
                    if match:
                        content = match.group(1)
                        # 학교명인지 확인
                        if self.is_school_name(content):
                            # 지역명+학교명 분리 시도
                            edu, school = self.parse_abbreviated_school_format(content)
                            if school:
                                result['현재분회'] = school
                            if edu:
                                result['현재교육청'] = edu
                            elif not edu and school:
                                # 학교명에서 교육청 찾기 시도
                                edu = self.find_education_office_for_school(school, hints)
                                if edu:
                                    result['현재교육청'] = edu
                                    
                    # 2. 단순히 학교명이 적혀있는 경우
                    if not result['현재분회'] and self.is_school_name(field_10):
                        school = self.expand_school_abbreviation(field_10)
                        result['현재분회'] = school
                        # 교육청 찾기
                        edu = self.find_education_office_for_school(school, hints)
                        if edu:
                            result['현재교육청'] = edu
                            
                    # 3. "서울", "경기" 등 타시도 지역명이 적혀있는 경우
                    if not result['현재교육청']:
                        # 강원도 지역명이 아닌 다른 지역명이 있는지 확인
                        # 간단하게 2글자 지역명으로 추정
                        potential_region = field_10[:2]
                        if potential_region not in self.GANGWON_REGIONS:
                             # 서울, 경기, 부산 등...
                             # 타시도는 교육청 공란 유지 (Fix 4)
                             pass


        # 9번째 필드 → 과목 처리 (학교명 감지 및 이동)
        # 이 부분은 발령분회/현재분회가 모두 처리된 후에 실행됨
        if len(row) > 8:
            subject_field = str(row.iloc[8]).strip() if pd.notna(row.iloc[8]) else ''

            if subject_field:
                # 먼저 "xxx병설유 교사" 같은 패턴인지 확인
                school_part, position_part = self.parse_school_with_position(subject_field)

                if position_part:
                    # "학교명 + 직위" 패턴이 감지됨
                    print(f"  🏫 학교명+직위 분리: '{subject_field}' → 학교='{school_part}', 직위='{position_part}'")

                    # 학교명 처리
                    if school_part:
                        edu_office = self.find_education_office_for_school(school_part, hints)

                        # 발령분회가 비어있으면 발령분회로 이동
                        if not result['발령분회']:
                            result['발령분회'] = school_part
                            if edu_office:
                                result['발령교육청'] = edu_office
                        # 현재분회가 비어있으면 현재분회로 이동
                        elif not result['현재분회']:
                            result['현재분회'] = school_part
                            if edu_office:
                                result['현재교육청'] = edu_office

                    # 직위 처리 (직위 필드가 비어있으면 채우기)
                    if not result['직위'] and position_part:
                        result['직위'] = self.normalize_position(position_part)

                    # 과목 필드는 비우기
                    result['과목'] = ''

                # 학교명인지 확인
                elif self.is_school_name(subject_field):
                    # 학교명을 올바른 형식으로 확장
                    school_name = self.expand_school_abbreviation(subject_field)

                    # 교육지원청 찾기
                    edu_office = self.find_education_office_for_school(school_name, hints)

                    # 발령분회가 비어있으면 발령분회로 이동
                    if not result['발령분회']:
                        result['발령분회'] = school_name
                        if edu_office:
                            result['발령교육청'] = edu_office
                    # 현재분회가 비어있으면 현재분회로 이동
                    elif not result['현재분회']:
                        result['현재분회'] = school_name
                        if edu_office:
                            result['현재교육청'] = edu_office
                    # 둘 다 채워져 있으면 과목으로 유지 (예외 케이스)
                    else:
                        result['과목'] = subject_field

                    # 과목 필드는 빈 문자열로 (학교명이 이동되었으므로)
                    if result['발령분회'] == school_name or result['현재분회'] == school_name:
                        result['과목'] = ''
                else:
                    # 학교명이 아니면 과목으로 그대로 유지
                    result['과목'] = subject_field

        # ===== 최종 검증 및 정리 =====

        # 1. 과목 필드에서 '휴직복직', '파견복귀' 등을 비고로 이동
        gwanri_keywords = ['휴직복직', '파견복귀', '휴직', '복직', '파견', '복귀']
        if result['과목']:
            for keyword in gwanri_keywords:
                if keyword in result['과목']:
                    # 비고로 이동
                    result['비고'] = result['과목']
                    result['과목'] = ''
                    break

        # 2. 발령분회가 있으면 발령교육청 자동 채우기 (아직 비어있는 경우)
        if result['발령분회'] and not result['발령교육청']:
            edu_office = self.find_education_office_for_school(result['발령분회'], hints)

            if not edu_office:
                # 지역명 추출 시도 (학교명에서)
                region = self.extract_region_from_text(result['발령분회'])
                if region:
                    edu_office = self.get_education_office(region)

            if not edu_office and hints['education_offices']:
                # 행에서 발견된 교육청 정보 사용
                edu_office = hints['education_offices'][0]

            if not edu_office and hints['regions']:
                # 행에서 발견된 지역 정보 사용
                edu_office = self.get_education_office(hints['regions'][0])

            if edu_office:
                result['발령교육청'] = edu_office
            else:
                # 디버깅: 매칭 실패한 학교 로그
                print(f"⚠️ 교육청 매칭 실패 (발령분회): '{result['발령분회']}' | 힌트: regions={hints['regions']}, edu_offices={hints['education_offices']}")

        # 3. 현재분회가 있으면 현재교육청 자동 채우기 (아직 비어있는 경우)
        if result['현재분회'] and not result['현재교육청']:
            edu_office = self.find_education_office_for_school(result['현재분회'], hints)

            if not edu_office:
                # 지역명 추출 시도 (학교명에서)
                region = self.extract_region_from_text(result['현재분회'])
                if region:
                    edu_office = self.get_education_office(region)

            if not edu_office and hints['education_offices']:
                # 행에서 발견된 교육청 정보 사용 (발령교육청이 아직 사용 안 했으면)
                for edu_off in hints['education_offices']:
                    if edu_off != result.get('발령교육청', ''):
                        edu_office = edu_off
                        break
                if not edu_office:
                    edu_office = hints['education_offices'][0]

            if not edu_office and hints['regions']:
                # 행에서 발견된 지역 정보 사용
                for region in hints['regions']:
                    potential_edu = self.get_education_office(region)
                    if potential_edu != result.get('발령교육청', ''):
                        edu_office = potential_edu
                        break
                if not edu_office:
                    edu_office = self.get_education_office(hints['regions'][0])

            if edu_office:
                result['현재교육청'] = edu_office
            else:
                # 디버깅: 매칭 실패한 학교 로그
                print(f"⚠️ 교육청 매칭 실패 (현재분회): '{result['현재분회']}' | 힌트: regions={hints['regions']}, edu_offices={hints['education_offices']}")

        # 4. 교육청 이름이 잘못된 필드에 있으면 제거
        # 교육청은 현재교육청, 발령교육청에만 들어가야 함
        education_office_keywords = ['교육청', '교육지원청']

        for field_name in ['이름', '발령분회', '현재분회', '과목', '직위', '비고']:
            field_value = result.get(field_name, '')
            if field_value:
                # 교육청 키워드가 있는지 확인
                has_edu_office = any(keyword in field_value for keyword in education_office_keywords)

                if has_edu_office:
                    # 발령교육청이 비어있으면 이동
                    if not result['발령교육청']:
                        result['발령교육청'] = field_value
                        result[field_name] = ''
                    # 현재교육청이 비어있으면 이동
                    elif not result['현재교육청']:
                        result['현재교육청'] = field_value
                        result[field_name] = ''
                    # 둘 다 채워져 있으면 현재 필드에서 제거만
                    else:
                        result[field_name] = ''

        # 5. 현재분회와 발령분회에서 지역명 제거
        if result['현재분회']:
            result['현재분회'] = self.remove_region_prefix_from_school_name(result['현재분회'])

        if result['발령분회']:
            result['발령분회'] = self.remove_region_prefix_from_school_name(result['발령분회'])

        # 6. 중복 학교명인 경우 교육청을 비우기
        # 남산초, 중앙초, 조양초, 교동초 등이 여러 지역에 있는 경우
        if result['현재분회'] and self.is_duplicate_school_name(result['현재분회']):
            result['현재교육청'] = ''

        if result['발령분회'] and self.is_duplicate_school_name(result['발령분회']):
            result['발령교육청'] = ''

        return result

    def parse_dataframe(self, df: pd.DataFrame) -> pd.DataFrame:
        """
        DataFrame 전체를 파싱하여 강원교총 표준 형식으로 변환
        """
        parsed_rows = []

        for idx, row in df.iterrows():
            # 유효한 데이터 행만 처리
            if self.is_valid_data_row(row):
                parsed_data = self.parse_row_to_kfta(row)
                parsed_rows.append(parsed_data)

        return pd.DataFrame(parsed_rows)
