# Excel Unifier 사용 가이드

## 개요

Excel Unifier는 서로 다른 양식으로 작성된 여러 엑셀 파일을 자동으로 분석하고 통합하는 도구입니다.

## 주요 특징

### 1. 자동 컬럼 매핑
다른 이름을 사용하지만 같은 의미의 컬럼을 자동으로 찾아 매핑합니다.

**예시:**
```
"이름", "성명", "학생명" → "이름"으로 통일
"학교", "대학교", "소속대학" → "학교"로 통일
"전화번호", "연락처", "휴대폰" → "연락처"로 통일
```

### 2. 스마트 값 정규화
같은 의미지만 표기가 다른 값들을 동일하게 인식합니다.

**예시:**
```
"서울대학교" = "서울대" = "서울大學校"
"연세대" = "연세대학교"
"고려대" = "고려대학교"
```

### 3. 지능형 중복 제거
키 컬럼을 기준으로 중복 데이터를 자동으로 병합합니다.

**예시:**
- 이름이 "김철수", 학교가 "서울대학교"인 행
- 이름이 "김철수", 학교가 "서울대"인 행
→ 하나로 통합 (가장 완전한 데이터 유지)

## 실전 사용 시나리오

### 시나리오 1: 여러 부서의 학생 명단 통합

**상황:** 각 부서에서 다른 양식으로 학생 명단을 작성함

```bash
# 모든 엑셀 파일 통합
./run.sh department1.xlsx department2.xlsx department3.xlsx \
  -o students_merged.xlsx \
  -k 이름 학년
```

**결과:**
- 부서별로 다른 컬럼명 사용해도 자동 매핑
- 같은 학생이 여러 번 등장해도 자동 제거
- 통일된 양식으로 출력

### 시나리오 2: 과거 데이터와 신규 데이터 병합

**상황:** 작년 데이터와 올해 데이터의 양식이 다름

```bash
./run.sh data_2023.xlsx data_2024.xlsx \
  -o merged_data.xlsx \
  -k 학번 이름
```

**결과:**
- 양식이 달라도 자동으로 필드 매핑
- 학번과 이름이 같은 학생은 중복 제거

### 시나리오 3: 여러 지역 데이터 통합

**상황:** 각 지역 담당자가 다른 형식으로 데이터 작성

```bash
./run.sh seoul.xlsx busan.xlsx daegu.xlsx \
  -o nationwide.xlsx \
  -t 80
```

**결과:**
- 유사도 임계값 80으로 설정 (더 관대하게 매칭)
- 약간 다른 표기도 같은 것으로 인식

## 고급 사용법

### 유사도 조정

**높은 임계값 (90-100):** 정확한 매칭만 허용
```bash
./run.sh *.xlsx -o output.xlsx -t 95 -k 이름
```

**낮은 임계값 (70-80):** 더 많은 유사 항목 허용
```bash
./run.sh *.xlsx -o output.xlsx -t 75 -k 이름
```

### 여러 키 컬럼 사용

```bash
# 이름과 생년월일이 모두 같아야 중복으로 간주
./run.sh *.xlsx -o output.xlsx -k 이름 생년월일

# 이름, 학교, 학년이 모두 같아야 중복으로 간주
./run.sh *.xlsx -o output.xlsx -k 이름 학교 학년
```

### 분석 리포트 생성

```bash
./run.sh *.xlsx -o output.xlsx -k 이름 -r analysis_report.txt
```

리포트에는 다음 정보가 포함됩니다:
- 처리된 파일 수
- 총 행 수
- 컬럼 매핑 상세 정보
- 중복 제거 통계

## 문제 해결

### 문제: 컬럼이 제대로 매핑되지 않음

**해결 방법:**
1. 유사도 임계값을 낮춤 (`-t 70`)
2. 컬럼명이 너무 다르면 수동으로 통일

### 문제: 중복 제거가 너무 많이 됨

**해결 방법:**
1. 키 컬럼을 더 추가하여 정확도 향상
2. 유사도 임계값을 높임 (`-t 95`)

### 문제: 중복 제거가 안 됨

**해결 방법:**
1. 키 컬럼을 명확히 지정 (`-k 이름 학교`)
2. 유사도 임계값을 낮춤 (`-t 75`)

## Python 모듈로 사용

```python
from excel_unifier import ExcelUnifier

# 초기화
unifier = ExcelUnifier(similarity_threshold=85)

# 파일 로드
files = ['file1.xlsx', 'file2.xlsx', 'file3.xlsx']
unifier.load_excel_files(files)

# 컬럼 분석
mappings = unifier.analyze_columns()
print("컬럼 매핑:", mappings)

# 데이터 통합
df = unifier.unify_dataframes(key_columns=['이름', '학교'])

# 결과 저장
unifier.save_unified_excel('output.xlsx', df)

# 리포트 생성
report = unifier.generate_report()
print(report)
```

## 팁과 모범 사례

1. **먼저 예제로 테스트**: 실제 데이터 처리 전 예제 파일로 테스트
2. **백업 유지**: 원본 파일은 항상 백업
3. **적절한 키 컬럼 선택**: 고유성을 보장하는 컬럼 조합 사용
4. **리포트 확인**: 통합 후 리포트를 확인하여 의도대로 처리되었는지 점검
5. **점진적 통합**: 한 번에 모든 파일보다 단계별로 통합하는 것이 안전

## 지원되는 파일 형식

- `.xlsx` (Excel 2007 이상)
- `.xls` (Excel 97-2003)
- `.csv` (UTF-8 인코딩 권장)

## 성능 고려사항

- **대용량 파일**: 10,000행 이상의 파일은 처리 시간이 오래 걸릴 수 있음
- **메모리**: 파일 크기의 약 3-5배 메모리 필요
- **최적화**: 불필요한 컬럼은 미리 제거하면 성능 향상
